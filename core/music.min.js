function musicInit(){let t=document.getElementsByClassName("song"),a=[],l=document.title,e=document.getElementsByClassName("amplitude-volume-slider")[0],n=50,i=0,s=2,r=20,u=document.getElementsByClassName("meta-lyrics")[0],o=new Map;void 0===localStorage["music-volume"]?localStorage["music-volume"]=e.value:(n=parseInt(localStorage["music-volume"]),e.value=isNaN(n)?50:n),e.addEventListener("change",function(){localStorage["music-volume"]=this.value});for(let e=0;e<t.length;e++)t[e].addEventListener("click",function(){this.querySelectorAll(".play-button-container")[0].style.display="none"}),a.push({name:t[e].dataset.title,artist:t[e].dataset.artist,album:t[e].dataset.group,url:t[e].dataset.url,cover_art_url:t[e].dataset.cover,visualization:"michaelbromley_visualization",lrc:t[e].dataset.lrc,time_callbacks:{0:function(){let e=Amplitude.getActiveSongMetadata();if(i=0,o.has(e.url))c(e.url);else{const t=new XMLHttpRequest;t.onreadystatechange=()=>{4===t.readyState&&(200<=t.status&&t.status<300||304===t.status?(o.set(e.url,function(e){{if(e){const o=(e=e.replace(/([^\]^\n])\[/g,(e,t)=>t+"\n[")).split("\n");let t=[];var a=o.length;for(let e=0;e<a;e++){var l=o[e].match(/\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/g),n=o[e].replace(/.*\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/g,"").replace(/<(\d{2}):(\d{2})(\.(\d{2,3}))?>/g,"").replace(/^\s+|\s+$/g,"");if(l){var i=l.length;for(let e=0;e<i;e++){var s=/\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/.exec(l[e]),r=60*s[1],u=parseInt(s[2]),s=s[4]?parseInt(s[4])/(2===(s[4]+"").length?100:1e3):0,s=r+u+s;t.push([s,n])}}}return t=t.filter(e=>e[1]),t.sort((e,t)=>e[0]-t[0]),t[t.length]=[t[t.length-1][0]+3,""],t}return[]}}(t.responseText)),c(e.url)):console.log("LRC file request fails: status "+t.status))},t.open("get",e.lrc,!0),t.send(null)}}}});function c(e){u.innerHTML="";var t,e=o.get(e);let a=document.createElement("ul");for(t of e){let e=document.createElement("li");e.innerHTML=t[1],a.appendChild(e)}u.appendChild(a),d()}function d(){const e=document.querySelectorAll(".meta-lyrics ul li");for(var t of e)t.classList.remove("active");0<e.length&&e[i].classList.add("active"),i>s&&(document.querySelectorAll(".meta-lyrics ul")[0].style.transform=`translateY(-${(i-s+2)*r}px)`)}function m(){var e=Amplitude.getActiveSongMetadata();document.querySelector(".song-name[data-amplitude-song-info=name]")?.setAttribute("title",e.name)}Amplitude.init({songs:a,volume:n,callbacks:{initialized:function(){m()},song_change:function(){m()},play:function(){document.getElementById("album-art").style.visibility="hidden",document.getElementById("large-visualization").style.visibility="visible";var e=Amplitude.getActiveSongMetadata();document.title=`正在播放《${e.name}》 - ${e.artist} `+l},pause:function(){document.getElementById("album-art").style.visibility="visible",document.getElementById("large-visualization").style.visibility="hidden",document.title=l},timeupdate:function(){var e,t,a=Amplitude.getActiveSongMetadata();void 0!==o.get(a.url)?(e=o.get(a.url),t=(event.currentTarget||event.target).currentTime,i!==e.length&&(function(t,e){var a=o.get(e);for(let e=i;e<a.length;e++)if(t<a[e+1][0]&&t>a[e][0]){i=e;break}}(t,a.url),d())):u.innerHTML="loading..."},seeked:function(){var e=Amplitude.getActiveSongMetadata();if(void 0!==o.get(e.url)){var t=(event.currentTarget||event.target).currentTime,a=o.get(e.url);for(let e=0;e<a.length;e++)if(t<a[e+1][0]&&t<a[e][0]){i=e;break}}}},waveforms:{sample_rate:100},visualization:"michaelbromley_visualization",visualizations:[{object:MichaelBromleyVisualization,params:{}}]}),document.getElementById("large-visualization").style.height=document.getElementById("album-art").offsetWidth+"px"}$(function(){var e=$("meta[name=cdn-base-address]").attr("content");"undefined"==typeof Amplitude?$.when($.getScript(e+"/lib/amplitudejs/amplitude.min.js"),$.getScript(e+"/lib/amplitudejs/visualizations/michaelbromley.js"),$.Deferred(function(e){$(e.resolve)})).done(function(){musicInit()}):musicInit(),$(document).on("pjax:send",function(){Amplitude?.stop()})});
//# sourceMappingURL=music.min.js.map