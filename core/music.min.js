function musicInit(){let t=document.getElementsByClassName("song"),a=[],l=document.title,e=document.getElementsByClassName("amplitude-volume-slider")[0],i=50,n=0,r=2,s=20,u=document.getElementsByClassName("meta-lyrics")[0],o=new Map;void 0===localStorage["music-volume"]?localStorage["music-volume"]=e.value:(i=parseInt(localStorage["music-volume"]),e.value=isNaN(i)?50:i),e.addEventListener("change",function(){localStorage["music-volume"]=this.value});for(let e=0;e<t.length;e++)t[e].addEventListener("click",function(){this.querySelectorAll(".play-button-container")[0].style.display="none"}),a.push({name:t[e].dataset.title,artist:t[e].dataset.artist,album:t[e].dataset.group,url:t[e].dataset.url,cover_art_url:t[e].dataset.cover,visualization:"michaelbromley_visualization",lrc:t[e].dataset.lrc,time_callbacks:{0:function(){let e=Amplitude.getActiveSongMetadata();if(n=0,o.has(e.url))c(e.url);else{const t=new XMLHttpRequest;t.onreadystatechange=()=>{4===t.readyState&&(200<=t.status&&t.status<300||304===t.status?(o.set(e.url,function(e){{if(e){var a=(e=e.replace(/([^\]^\n])\[/g,(e,t)=>t+"\n[")).split("\n");let t=[];var l=a.length;for(let e=0;e<l;e++){var i=a[e].match(/\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/g),n=a[e].replace(/.*\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/g,"").replace(/<(\d{2}):(\d{2})(\.(\d{2,3}))?>/g,"").replace(/^\s+|\s+$/g,"");if(i){var r=i.length;for(let e=0;e<r;e++){var s=/\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/.exec(i[e]),u=60*s[1],o=parseInt(s[2]),s=s[4]?parseInt(s[4])/(2===(s[4]+"").length?100:1e3):0,u=u+o+s;t.push([u,n])}}}return(t=t.filter(e=>e[1])).sort((e,t)=>e[0]-t[0]),t[t.length]=[t[t.length-1][0]+3,""],t}return[]}}(t.responseText)),c(e.url)):console.log("LRC file request fails: status "+t.status))},t.open("get",e.lrc,!0),t.send(null)}}}});function c(e){u.innerHTML="";var t,e=o.get(e),a=document.createElement("ul");for(t of e){var l=document.createElement("li");l.innerHTML=t[1],a.appendChild(l)}u.appendChild(a),d()}function d(){var e,t=document.querySelectorAll(".meta-lyrics ul li");for(e of t)e.classList.remove("active");0<t.length&&t[n].classList.add("active"),n>r&&(document.querySelectorAll(".meta-lyrics ul")[0].style.transform=`translateY(-${(n-r+2)*s}px)`)}function m(){var e=Amplitude.getActiveSongMetadata();document.querySelector(".song-name[data-amplitude-song-info=name]")?.setAttribute("title",e.name)}Amplitude.init({songs:a,volume:i,callbacks:{initialized:function(){m()},song_change:function(){m()},play:function(){document.getElementById("album-art").style.visibility="hidden",document.getElementById("large-visualization").style.visibility="visible";var e=Amplitude.getActiveSongMetadata();document.title=`正在播放《${e.name}》 - ${e.artist} `+l},pause:function(){document.getElementById("album-art").style.visibility="visible",document.getElementById("large-visualization").style.visibility="hidden",document.title=l},timeupdate:function(){var e=Amplitude.getActiveSongMetadata();if(void 0!==o.get(e.url)){var t=o.get(e.url),a=(event.currentTarget||event.target).currentTime;if(n!==t.length){var l=a,t=e.url,i=o.get(t);for(let e=n;e<i.length;e++)if(l<i[e+1][0]&&l>i[e][0]){n=e;break}d()}}else u.innerHTML="loading..."},seeked:function(){var e=Amplitude.getActiveSongMetadata();if(void 0!==o.get(e.url)){var t=(event.currentTarget||event.target).currentTime,a=o.get(e.url);for(let e=0;e<a.length;e++)if(t<a[e+1][0]&&t<a[e][0]){n=e;break}}}},waveforms:{sample_rate:100},visualization:"michaelbromley_visualization",visualizations:[{object:MichaelBromleyVisualization,params:{}}]})}$(function(){var e=$("meta[name=cdn-base-address]").attr("content");"undefined"==typeof Amplitude?$.when($.getScript(e+"/lib/amplitudejs/amplitude.min.js"),$.getScript(e+"/lib/amplitudejs/visualizations/michaelbromley.js"),$.Deferred(function(e){$(e.resolve)})).done(function(){musicInit()}):musicInit(),$(document).on("pjax:send",function(){Amplitude?.stop()})});
//# sourceMappingURL=music.min.js.map