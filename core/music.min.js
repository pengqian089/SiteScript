function musicInit(){let t=document.getElementsByClassName("song"),l=[],a=document.title,e=document.getElementsByClassName("amplitude-volume-slider")[0],n=50,i=0,s=2,r=20,o=document.getElementsByClassName("meta-lyrics")[0],c=new Map,u=!0,d=document.getElementById("music-search-input"),m=document.getElementById("search-clear-btn"),g=document.querySelector(".songs-list-container"),v=[];void 0===localStorage["music-volume"]?localStorage["music-volume"]=e.value:(n=parseInt(localStorage["music-volume"]),e.value=isNaN(n)?50:n),e.addEventListener("change",function(){localStorage["music-volume"]=this.value});for(let e=0;e<t.length;e++)t[e].addEventListener("click",function(){this.querySelectorAll(".play-button-container")[0].style.display="none"}),l.push({name:t[e].dataset.title,artist:t[e].dataset.artist,album:t[e].dataset.group,url:t[e].dataset.url,cover_art_url:t[e].dataset.cover,visualization:"michaelbromley_visualization",lrc:t[e].dataset.lrc,time_callbacks:{0:function(){let e=Amplitude.getActiveSongMetadata();if(i=0,c.has(e.url))y(e.url);else{const t=new XMLHttpRequest;t.onreadystatechange=()=>{4===t.readyState&&(200<=t.status&&t.status<300||304===t.status?(c.set(e.url,function(e){{if(e){var l=(e=e.replace(/([^\]^\n])\[/g,(e,t)=>t+"\n[")).split("\n");let t=[];var a=l.length;for(let e=0;e<a;e++){var n=l[e].match(/\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/g),i=l[e].replace(/.*\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/g,"").replace(/<(\d{2}):(\d{2})(\.(\d{2,3}))?>/g,"").replace(/^\s+|\s+$/g,"");if(n){var s=n.length;for(let e=0;e<s;e++){var r=/\[(\d{2}):(\d{2})(\.(\d{2,3}))?]/.exec(n[e]),o=60*r[1],c=parseInt(r[2]),r=r[4]?parseInt(r[4])/(2===(r[4]+"").length?100:1e3):0,o=o+c+r;t.push([o,i])}}}return(t=t.filter(e=>e[1])).sort((e,t)=>e[0]-t[0]),t[t.length]=[t[t.length-1][0]+3,""],t}return[]}}(t.responseText)),y(e.url)):console.log("LRC file request fails: status "+t.status))},t.open("get",e.lrc,!0),t.send(null)}}}});function y(e){o.innerHTML="";var t,e=c.get(e),l=(u?o.classList.add("scrolling-lyrics"):o.classList.remove("scrolling-lyrics"),document.createElement("ul"));for(t of e){var a=document.createElement("li");a.innerHTML=t[1],l.appendChild(a)}o.appendChild(l),p()}function p(){var e,t,l=document.querySelectorAll(".meta-lyrics ul li");for(e of l)e.classList.remove("active","long-text","medium-text");0<l.length&&((l=l[i]).classList.add("active"),u)&&o.classList.contains("scrolling-lyrics")&&(50<(t=l.textContent.length)?l.classList.add("long-text"):30<t&&l.classList.add("medium-text")),i>s&&(t=document.querySelectorAll(".meta-lyrics ul")[0])&&(t.style.transform=`translateY(-${(i-s+2)*r}px)`)}function f(){var e=Amplitude.getActiveSongMetadata();document.querySelector(".song-name[data-amplitude-song-info=name]")?.setAttribute("title",e.name)}function h(i){if(i){let n=0;if(v.forEach((e,t)=>{var l=e.dataset.title?.toLowerCase()||"",a=e.dataset.artist?.toLowerCase()||"";l.includes(i)||a.includes(i)?(e.style.display="flex",e.classList.add("search-highlight"),n++):(e.style.display="none",e.classList.remove("search-highlight"))}),0===n){let e=document.querySelector(".no-search-results");e||((e=document.createElement("div")).className="no-search-results",e.innerHTML=`
                <div class="no-results-content">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                        <line x1="11" y1="8" x2="11" y2="12"></line>
                        <line x1="11" y1="16" x2="11" y2="16"></line>
                    </svg>
                    <p>未找到匹配的歌曲</p>
                    <span>试试搜索其他关键词</span>
                </div>
            `,g.appendChild(e));e.style.display="flex"}else(e=document.querySelector(".no-search-results"))&&(e.style.display="none");var e}else v.forEach(e=>{e.style.display="flex",e.classList.remove("search-highlight")})}Amplitude.init({songs:l,volume:n,callbacks:{initialized:function(){f()},song_change:function(){f()},play:function(){document.getElementById("album-art").style.visibility="hidden",document.getElementById("large-visualization").style.visibility="visible";var e=Amplitude.getActiveSongMetadata();document.title=`正在播放《${e.name}》 - ${e.artist} `+a},pause:function(){document.getElementById("album-art").style.visibility="visible",document.getElementById("large-visualization").style.visibility="hidden",document.title=a},timeupdate:function(){var e=Amplitude.getActiveSongMetadata();if(void 0!==c.get(e.url)){var t=c.get(e.url),l=(event.currentTarget||event.target).currentTime;if(i!==t.length){var a=l,t=e.url,n=c.get(t);for(let e=i;e<n.length;e++)if(a<n[e+1][0]&&a>n[e][0]){i=e;break}p()}}else o.innerHTML="loading..."},seeked:function(){var e=Amplitude.getActiveSongMetadata();if(void 0!==c.get(e.url)){var t=(event.currentTarget||event.target).currentTime,l=c.get(e.url);for(let e=0;e<l.length;e++)if(t<l[e+1][0]&&t<l[e][0]){i=e;break}}}},waveforms:{sample_rate:100},visualization:"michaelbromley_visualization",visualizations:[{object:MichaelBromleyVisualization,params:{}}]}),v=Array.from(document.querySelectorAll(".song")),d&&m&&g?(d.addEventListener("input",function(e){e=e.target.value.trim().toLowerCase();m.style.display=e?"flex":"none",h(e)}),m.addEventListener("click",function(){d.value="",m.style.display="none",h(""),d.focus()}),d.addEventListener("keydown",function(e){"Escape"===e.key&&(d.value="",m.style.display="none",h(""),d.blur())})):console.warn("搜索框元素未找到")}$(function(){var e=$("meta[name=cdn-base-address]").attr("content");"undefined"==typeof Amplitude?$.when($.getScript(e+"/lib/amplitudejs/amplitude.min.js"),$.getScript(e+"/lib/amplitudejs/visualizations/michaelbromley.js"),$.Deferred(function(e){$(e.resolve)})).done(function(){musicInit()}):musicInit(),$(document).on("pjax:send",function(){Amplitude?.stop()})});
//# sourceMappingURL=music.min.js.map