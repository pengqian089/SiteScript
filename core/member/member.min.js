let CONSTANTS={PAGES:{PROFILE:"profile",ARTICLES:"articles",MUMBLES:"mumbles",TIMELINE:"timeline",PHOTOS:"photos"},PAGINATION:{DEFAULT_PAGE_SIZE:10,DEFAULT_PAGE_NUM:1,MAX_VISIBLE_PAGES:5},BREAKPOINTS:{MOBILE:768,TABLET:768,DESKTOP:1024},DELAYS:{LOADING:300,TOAST_AUTO_HIDE:3e3,TOAST_HIDE_ANIMATION:300},MESSAGE_TYPES:{SUCCESS:{type:"success",icon:"fa-check-circle",color:"#059669",bgColor:"#ffffff",borderColor:"#10b981",textColor:"#065f46"},ERROR:{type:"error",icon:"fa-times-circle",color:"#dc2626",bgColor:"#ffffff",borderColor:"#ef4444",textColor:"#7f1d1d"},WARNING:{type:"warning",icon:"fa-exclamation-triangle",color:"#d97706",bgColor:"#ffffff",borderColor:"#f59e0b",textColor:"#92400e"},INFO:{type:"info",icon:"fa-info-circle",color:"#2563eb",bgColor:"#ffffff",borderColor:"#3b82f6",textColor:"#1e40af"}},SELECTORS:{navItem:".nav-item",navItemLink:".nav-item a",contentPage:".content-page",currentPageTitle:"#currentPageTitle",menuToggle:".menu-toggle",sidebarOverlay:".sidebar-overlay",memberSidebar:".member-sidebar",tableContainer:".table-container",photosGrid:".photos-grid",publishModal:"#publishModal",deleteModal:"#deleteModal",twoFactorModal:"#twoFactorModal",modalBody:"#modalBody",modalTitle:"#modalTitle",confirmPublish:"#confirmPublish",loadingOverlay:"#loadingOverlay",toastContainer:"#toast-container",progressOverlay:"#progressOverlay"}};class MemberCenter{constructor(){this.state={currentPage:CONSTANTS.PAGES.PROFILE,currentTheme:"light",currentDeleteItem:null},this.cherryInstance=null,this.photoViewer=null,this.initialize()}initialize(){try{this.bindEvents(),this.initPjax(),this.initTheme(),this.initMarkdownEditor(),this.initPhotoViewer(),0<$("#startRecording").length&&this.initAudioRecorder()}catch(e){console.error("初始化失败:",e),this.showMessage("系统初始化失败，请刷新页面重试","error")}}initPjax(){$.pjax.defaults.timeout=5e3;$(document).pjax(["nav.member-nav > ul > li.nav-item > a","#newArticle","#newMumble","#newTimeline","#uploadPhoto",".page-header .btn-secondary",".list-actions a",".photo-actions a"].join(", "),"#pjax-container",{scrollTo:0}),$(document).pjax("#member-article .pagination a","#member-article",{scrollTo:0}),$(document).pjax("#member-mumble .pagination a","#member-mumble",{scrollTo:0}),$(document).pjax("#member-timeline .pagination a","#member-timeline",{scrollTo:0}),$(document).pjax("#member-photo .pagination a","#member-photo",{scrollTo:0}),$(document).on("pjax:send",()=>{$(CONSTANTS.SELECTORS.loadingOverlay).addClass("active")}),$(document).on("pjax:complete",()=>{$(CONSTANTS.SELECTORS.loadingOverlay).removeClass("active")}),$(document).on("pjax:end",()=>{window.scrollTo(0,0),0<$("#startRecording").length&&this.initAudioRecorder(),this.initMarkdownEditor(),this.initPhotoViewer(),this.updatePageTitle(),this.isMobile()&&this.closeMobileMenu()}),0===$(CONSTANTS.SELECTORS.progressOverlay).length&&$("body").append(`
                <div class="loading-overlay" id="progressOverlay" style="display: none; flex-direction: column; z-index: 9999;">
                    <div class="loading-spinner" style="width: 80%; max-width: 400px; text-align: center;">
                        <div style="font-size: 1.1rem; margin-bottom: 15px; color: var(--text-color);" id="progressText">准备上传...</div>
                        <div style="width: 100%; height: 10px; background: rgba(0,0,0,0.1); border-radius: 5px; overflow: hidden; position: relative;">
                             <div id="progressBar" class="progress-bar-animated" style="width: 0%; height: 100%; background-color: var(--primary-color); border-radius: 5px; transition: width 0.2s ease;"></div>
                        </div>
                        <div id="progressPercent" style="margin-top: 8px; font-size: 0.9rem; color: var(--text-secondary);">0%</div>
                    </div>
                </div>
            `),0===$(CONSTANTS.SELECTORS.progressOverlay).length&&$("body").append(`
                <div class="loading-overlay" id="progressOverlay" style="display: none; flex-direction: column; z-index: 9999;">
                    <div class="loading-spinner" style="width: 80%; max-width: 400px; text-align: center;">
                        <div style="font-size: 1.1rem; margin-bottom: 15px; color: var(--text-color);" id="progressText">准备上传...</div>
                        <div style="width: 100%; height: 10px; background: rgba(0,0,0,0.1); border-radius: 5px; overflow: hidden; position: relative;">
                             <div id="progressBar" class="progress-bar-animated" style="width: 0%; height: 100%; background-color: var(--primary-color); border-radius: 5px; transition: width 0.2s ease;"></div>
                        </div>
                        <div id="progressPercent" style="margin-top: 8px; font-size: 0.9rem; color: var(--text-secondary);">0%</div>
                    </div>
                </div>
            `)}updatePageTitle(){try{var t=$("nav.member-nav .nav-item.active a");let e="";e=(e=0<t.length?t.text().trim():e)||"个人中心",document.title=e+" - 个人中心"}catch(e){console.error("更新页面标题失败:",e)}}initAudioRecorder(){if(!this.audioRecorder){if("undefined"==typeof AudioRecorder)return;this.audioRecorder=new AudioRecorder({onMessage:(e,t)=>this.showMessage(e,t),onLoading:(e,t)=>e?this.showLoading(t):this.hideLoading()})}this.audioRecorder.init()}bindEvents(){this.bindMobileMenuEvents(),this.bindWindowEvents(),this.bindContentEvents(),this.bindModalEvents(),this.bindViewContentEvents(),this.bindKeyboardEvents(),this.bindSidebarActive()}bindSidebarActive(){$(document).on("click",CONSTANTS.SELECTORS.navItem,e=>{$(CONSTANTS.SELECTORS.navItem).removeClass("active"),$(e.currentTarget).addClass("active")})}initMarkdownEditor(){var e=document.getElementById("articleContent"),t=document.getElementById("mumbleContent"),a=document.getElementById("timelineContent");let r=document.getElementById("uploadAddress")?.value;e=e||t||a;if(e){t=document.getElementById("txt_"+e.id);if(t){a=e.id,e=t.value;this.cherryInstance&&(this.cherryInstance=null);let o=this;try{this.cherryInstance=new Cherry({id:a,value:e,height:"100%",defaultModel:"editOnly",themeSettings:{mainTheme:this.state.currentTheme,codeBlockTheme:"one-dark"},engine:{syntax:{codeBlock:{editCode:!1,changeLang:!1}}},toolbars:{toolbar:["bold","italic","size","|","color","header","togglePreview","|","theme",{insert:["image","link","hr","br","code","table"]}]},fileUpload:async function(e,t){r&&""!==r.trim()?await o.fileUpload(e,t,r):t("")}})}catch(e){console.error("Markdown 编辑器初始化失败:",e)}t.style.display="none",this.cherryInstance&&this.cherryInstance.switchModel("editOnly")}}}uploadWithProgress(e,r,i){return new Promise((t,o)=>{let a=new XMLHttpRequest;a.open("POST",e,!0),a.upload&&i&&(a.upload.onprogress=e=>{e.lengthComputable&&(e=Math.round(e.loaded/e.total*100),i(e))}),a.onload=()=>{if(200<=a.status&&a.status<300)try{var e=JSON.parse(a.responseText);t(e)}catch(e){o(new Error("Invalid JSON response"))}else o(new Error("Upload failed with status "+a.status))},a.onerror=()=>o(new Error("Network error")),a.send(r)})}async fileUpload(e,t,o){var a=new FormData;a.append("image",e);try{this.showProgress("正在上传图片...");var r=await this.uploadWithProgress(o,a,e=>{this.updateProgress(e,"正在上传图片...")});this.hideProgress(),t(r.url)}catch(e){this.hideProgress(),this.showMessage("图片上传失败: "+e.message,"error"),console.error("图片上传失败:",e)}}bindMobileMenuEvents(){$(document).on("click",CONSTANTS.SELECTORS.menuToggle,()=>this.toggleMobileMenu()),$(document).on("click",CONSTANTS.SELECTORS.sidebarOverlay,()=>this.closeMobileMenu())}bindWindowEvents(){$(window).on("resize",()=>this.handleResize())}bindContentEvents(){$(document).on("click","#saveProfile",()=>this.saveProfile()),$(document).on("click","#logout",()=>this.logout()),$(document).on("click","#uploadAvatar",()=>$("#avatarFile").click()),$(document).on("change","#avatarFile",e=>this.handleAvatarUpload(e)),$(document).on("click","#searchArticles",()=>{var e=$("#articleTitleSearch").val(),t=$("#articleTagSearch").val(),o=new URL("/member/articles",window.location.origin);e&&o.searchParams.set("title",e),t&&o.searchParams.set("tag",t),$.pjax({url:o.href,container:"#member-article",push:!0})}),$(document).on("click","#clearArticles",()=>{$("#articleTitleSearch").val(""),$("#articleTagSearch").val(""),$("#searchArticles").click()}),$(document).on("keyup","#articleTitleSearch",e=>{"Enter"===e.key&&$("#searchArticles").click()}),$(document).on("click","#searchMumbles",()=>{var e=$("#mumbleContentSearch").val(),t=new URL("/member/mumbles",window.location.origin);e&&t.searchParams.set("content",e),$.pjax({url:t.href,container:"#member-mumble",push:!0})}),$(document).on("click","#clearMumbles",()=>{$("#mumbleContentSearch").val(""),$("#searchMumbles").click()}),$(document).on("keyup","#mumbleContentSearch",e=>{"Enter"===e.key&&$("#searchMumbles").click()}),$(document).on("click","#searchTimeline",()=>{var e=$("#timelineSearch").val(),t=new URL("/member/timeline",window.location.origin);e&&t.searchParams.set("content",e),$.pjax({url:t.href,container:"#member-timeline",push:!0})}),$(document).on("click","#clearTimeline",()=>{$("#timelineSearch").val(""),$("#searchTimeline").click()}),$(document).on("keyup","#timelineSearch",e=>{"Enter"===e.key&&$("#searchTimeline").click()}),$(document).on("click","#searchPhotos",()=>{var e=$("#photoTagSearch").val(),t=$("#photoDescSearch").val(),o=new URL("/member/photos",window.location.origin);e&&o.searchParams.set("tag",e),t&&o.searchParams.set("description",t),$.pjax({url:o.href,container:"#member-photo",push:!0})}),$(document).on("click","#clearPhotos",()=>{$("#photoTagSearch").val(""),$("#photoDescSearch").val(""),$("#searchPhotos").click()}),$(document).on("keyup","#photoDescSearch",e=>{"Enter"===e.key&&$("#searchPhotos").click()}),$(document).on("click","#confirmPublish",e=>{e=$(e.currentTarget);let t=e.data("action");t&&"function"==typeof this[t]&&this.withButtonLoading(e,async()=>{await this[t]()})}),$(document).on("change","#photoFile",function(e){let t=e.target.files[0];t&&((e=new FileReader).onload=e=>{$("#photoPreview").attr("src",e.target.result),$("#photoPreview").show(),$("#imageLoadingPlaceholder").remove(),$("#previewContainer").addClass("active"),$("#dropZone").hide(),$("#fileName").text(t.name),$("#fileSize").text((e=>{var t;return 0===e?"0 B":(t=Math.floor(Math.log(e)/Math.log(1024)),parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB","TB"][t])})(t.size)),memberCenter.initPhotoViewer()},e.readAsDataURL(t))}),$(document).on("click","#removeFileBtn",function(){if($("#photoFile").val(""),$("#previewContainer").removeClass("active"),$("#dropZone").show(),$("#photoPreview").attr("src",""),memberCenter&&memberCenter.photoViewer){try{"function"==typeof memberCenter.photoViewer.close&&memberCenter.photoViewer.close()}catch(e){console.warn("关闭 PhotoSwipe 失败:",e)}memberCenter.photoViewer=null}}),$(document).on("click","#viewPhotoBtn",function(){var e=document.getElementById("photoPreview");memberCenter&&e&&e.src&&memberCenter.openPhotoSwipe(e)});let t=document.getElementById("dropZone");function o(e){e.preventDefault(),e.stopPropagation()}function a(e){t.classList.add("drag-over")}function r(e){t.classList.remove("drag-over")}t&&(["dragenter","dragover","dragleave","drop"].forEach(e=>{t.addEventListener(e,o,!1)}),["dragenter","dragover"].forEach(e=>{t.addEventListener(e,a,!1)}),["dragleave","drop"].forEach(e=>{t.addEventListener(e,r,!1)}),t.addEventListener("drop",function(e){var e=e.dataTransfer,e=e.files,t=document.getElementById("photoFile");0<e.length&&(t.files=e,e=new Event("change",{bubbles:!0}),t.dispatchEvent(e))},!1))}bindModalEvents(){$("#closeDeleteModal").on("click",()=>this.hideDeleteModal()),$("#cancelDelete").on("click",()=>this.hideDeleteModal()),$("#confirmDelete").on("click",()=>this.confirmDelete()),$(document).on("click",".modal-overlay",e=>{e.target===e.currentTarget&&this.hideDeleteModal()})}bindViewContentEvents(){$("#closeViewContentModal, #closeViewContentBtn").on("click",()=>{$("#viewContentModal").hide()}),$("#viewContentModal").on("click",e=>{e.target===e.currentTarget&&$("#viewContentModal").hide()}),$(document).on("click",".mobile-content-toggle",e=>{this.toggleMobileContent(e.target)})}showContent(e,t="markdown"){let o=e;"markdown"===t&&"undefined"!=typeof showdown?(a=new showdown.Converter,o=a.makeHtml(e)):"text"===t&&(o=$("<div>").text(e).html().replace(/\n/g,"<br>"));var a=$("<div>").html(o);if(a.find("img").css({"max-width":"100%",height:"auto"}),$("#viewContentModalBody").html(a),$("#viewContentModal").css("display","flex"),"undefined"!=typeof Prism)try{0<document.getElementById("viewContentModalBody").querySelectorAll("pre code").length&&Prism.highlightAllUnder(document.getElementById("viewContentModalBody"))}catch(e){console.error("代码高亮失败:",e)}}toggleMobileContent(e){var e=$(e),t=e.prev(".mobile-content-wrapper");t.hasClass("collapsed")?(t.removeClass("collapsed"),e.html('<i class="fa fa-angle-up"></i> 收起内容')):(t.addClass("collapsed"),e.html('<i class="fa fa-angle-down"></i> 展开全文'))}bindKeyboardEvents(){$(document).on("keydown",e=>{"Escape"===e.key&&this.hideDeleteModal()})}async saveProfile(){try{var e=new FormData;e.append("name",$("#nickname").val().trim()),e.append("sex",$("#gender").val()),e.append("sign",$("#signature").val().trim()),this.showLoading();var t=await(await fetch("/Account/UpdateInfo",{method:"POST",body:e})).json();this.hideLoading(),t.success?this.showMessage("保存成功","success"):this.showMessage(t.message||"保存失败","error")}catch(e){console.error("保存个人资料失败:",e),this.hideLoading(),this.showMessage("保存失败，请重试","error")}}async logout(){if(confirm("确定要退出登录吗？")){this.showLoading();try{var e=await fetch("/Account/LogOut",{method:"POST"});e.redirected?window.location.href=e.url:e.ok?window.location.href="/":this.showMessage("退出失败","error")}catch(e){console.error("退出失败:",e),this.showMessage("退出失败","error")}finally{this.hideLoading()}}}handleAvatarUpload(e){try{var t=e.target.files[0];t&&this.validateImageFile(t)&&(this.previewImage(t),this.uploadImage(t))}catch(e){console.error("头像上传失败:",e),this.showMessage("头像上传失败","error")}}validateImageFile(e){return e.type.startsWith("image/")?!(5242880<e.size&&(this.showMessage("图片文件不能超过5MB","error"),1)):(this.showMessage("请选择图片文件","error"),!1)}previewImage(e){var t=new FileReader;t.onload=e=>{$("#avatarPreview, #userAvatar").attr("src",e.target.result)},t.readAsDataURL(e)}async uploadImage(e){this.showLoading();var t=new FormData;t.append("avatar",e);try{var o=await(await fetch("/Account/UpdateAvatar",{method:"POST",body:t})).json();this.hideLoading(),o.success?this.showMessage("头像上传成功","success"):this.showMessage(o.msg,"error")}catch(e){this.hideLoading(),this.showMessage("上传发生错误","error")}}deleteItem(e,t){this.state.currentDeleteItem={type:e,id:t},$("#deleteModal").show()}confirmDelete(){this.state.currentDeleteItem&&(this.showLoading(),setTimeout(()=>{this.hideLoading(),this.hideDeleteModal(),this.showMessage("删除成功","success"),$.pjax.reload("#"+this.getCurrentContainerId())},300))}getCurrentContainerId(){return location.pathname.includes("articles")?"member-article":location.pathname.includes("mumbles")?"member-mumble":location.pathname.includes("timeline")?"member-timeline":location.pathname.includes("photos")?"member-photo":"pjax-container"}async publishArticle(){var o=document.getElementById("submitAddress");if(o){var o=o.value,a=document.getElementById("articleId").value,r=document.getElementById("articleTitle").value,i=document.getElementById("articleTags"),i=Array.from(i.selectedOptions).map(e=>e.value).join(","),n=document.getElementById("articleIntroduction").value,s=document.getElementById("articleExtraTags").value;let e="",t="";if(this.cherryInstance?(e=this.cherryInstance.getMarkdown(),t=this.cherryInstance.getHtml()):(l=document.getElementById("txt_articleContent"))&&(e=l.value,t=e),""===r.trim())this.showMessage("标题不能为空","warning");else if(""===s.trim()&&""===i.trim())this.showMessage("请选择标签或输入补充标签","warning");else if(""===n.trim())this.showMessage("简介不能为空","warning");else if(""===e.trim()||e.length<5)this.showMessage("内容不能为空","warning");else{var l=new FormData;""!==a.trim()&&l.append("id",a),l.append("title",r),l.append("tags",i),l.append("introduction",n),l.append("markdown",e),l.append("content",t),l.append("newTag",s);try{var c=await(await fetch(o,{method:"POST",body:l})).json();c.success?(this.showMessage("文章发布成功","success"),$.pjax({url:"/member/articles",container:"#pjax-container"})):this.showMessage(c.msg||"发布失败","error")}catch(e){this.showMessage("发布失败: "+e.message,"error")}}}}async publishMumble(){var o=document.getElementById("submitAddress");if(o){var o=o.value,a=document.getElementById("mumbleId")?.value;let e="",t="";if(this.cherryInstance?(e=this.cherryInstance.getMarkdown(),t=this.cherryInstance.getHtml()):(r=document.getElementById("mumbleContent"),e=r?r.value:""),!e||""===e.trim()||e.length<5)this.showMessage("请输入内容","warning");else{var r=new FormData;""!==a.trim()&&r.append("id",a),r.append("markdown",e),r.append("html",t);try{var i=await(await fetch(o,{method:"POST",body:r})).json();i.success?(this.showMessage("碎碎念发布成功","success"),$.pjax({url:"/member/mumbles",container:"#pjax-container"})):this.showMessage(i.msg||"发布失败","error")}catch(e){this.showMessage("发布失败: "+e.message,"error")}}}}async publishTimeline(){var t=document.getElementById("submitAddress");if(t){var t=t.value,o=document.getElementById("timelineId").value,a=document.getElementById("timelineTitle").value,r=document.getElementById("timelineMore").value,i=document.getElementById("timelineDate").value;let e="";if(e=this.cherryInstance?this.cherryInstance.getMarkdown():(n=document.getElementById("timelineContent"))?n.value:"",""===a.trim())this.showMessage("标题不能为空","warning");else if(""===i.trim())this.showMessage("时间不能为空","warning");else if(""===e.trim()||e.length<5)this.showMessage("内容不能为空","warning");else{var n=new FormData;""!==o.trim()&&n.append("id",o),n.append("title",a),n.append("more",r),n.append("date",i),n.append("content",e);try{var s=await(await fetch(t,{method:"POST",body:n})).json();s.success?(this.showMessage("时间轴发布成功","success"),$.pjax({url:"/member/timeline",container:"#pjax-container"})):this.showMessage(s.msg||"发布失败","error")}catch(e){this.showMessage("发布失败: "+e.message,"error")}}}}async publishPhoto(){var t=document.getElementById("submitAddress");if(t){var t=t.value,o=document.getElementById("photoId")?.value||"",a=document.getElementById("photoFile").files[0];if(""!==o.trim()||a){var r=document.getElementById("photoTags"),r=Array.from(r.selectedOptions).map(e=>e.value).join(","),i=document.getElementById("photoExtraTags").value,n=document.getElementById("photoDescription").value,s=new FormData;""!==o.trim()&&s.append("id",o),a&&s.append("photo",a),s.append("description",n);let e=r;i&&(e=e?e+","+i:i),s.append("tags",e);try{this.showProgress("正在上传照片...");var l=await this.uploadWithProgress(t,s,e=>{this.updateProgress(e,"正在上传照片...")});l.success?(this.showMessage("照片上传成功","success"),$.pjax({url:"/member/photos",container:"#pjax-container"})):this.showMessage(l.msg||"上传失败","error")}catch(e){this.showMessage("上传失败: "+e.message,"error")}finally{this.hideProgress()}}else this.showMessage("请选择照片","warning")}}hideDeleteModal(){$(CONSTANTS.SELECTORS.deleteModal).hide(),this.state.currentDeleteItem=null}showProgress(e="上传中..."){var t=$(CONSTANTS.SELECTORS.progressOverlay);0<t.length&&(t.find("#progressText").text(e),t.find("#progressBar").css("width","0%"),t.find("#progressPercent").text("0%"),t.css("display","flex").addClass("active"))}updateProgress(e,t){var o=$(CONSTANTS.SELECTORS.progressOverlay);0<o.length&&(t&&o.find("#progressText").text(t),o.find("#progressBar").css("width",e+"%"),o.find("#progressPercent").text(e+"%"))}hideProgress(){$(CONSTANTS.SELECTORS.progressOverlay).removeClass("active").fadeOut(200)}showLoading(e="加载中..."){var t=$(".loading-spinner .loading-text");0<t.length&&t.text(e),$(CONSTANTS.SELECTORS.loadingOverlay).addClass("active")}hideLoading(){$(CONSTANTS.SELECTORS.loadingOverlay).removeClass("active")}showMessage(e,t="info"){try{var o=CONSTANTS.MESSAGE_TYPES,a=o[t.toUpperCase()]||o.INFO,r=`message-${Date.now()}-`+Math.random().toString(36).substr(2,9),i=this.createToastElement(r,t,e,a);this.appendToastToContainer(i),this.animateToast(i,r)}catch(e){console.error("显示消息失败:",e)}}createToastElement(e,t,o,a){e=$(`
            <div class="toast-message" id="${e}" data-type="${t}">
                <div class="toast-content">
                    <div class="toast-icon">
                        <i class="fa ${a.icon}"></i>
                    </div>
                    <div class="toast-text">
                        <div class="toast-message-text">${o}</div>
                    </div>
                    <button type="button" class="toast-close">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                <div class="toast-progress">
                    <div class="toast-progress-bar"></div>
                </div>
            </div>
        `);return e.css({"--toast-color":a.color,"--toast-bg-color":a.bgColor,"--toast-border-color":a.borderColor,"--toast-text-color":a.textColor}),e}appendToastToContainer(e){let t=$(CONSTANTS.SELECTORS.toastContainer);0===t.length&&(t=$('<div id="toast-container"></div>'),$("body").append(t)),t.append(e)}animateToast(e,t){setTimeout(()=>{e.addClass("toast-show")},10),setTimeout(()=>{e.find(".toast-progress-bar").addClass("toast-progress-active")},100),e.find(".toast-close").on("click",()=>{this.hideMessage(t)}),setTimeout(()=>{this.hideMessage(t)},CONSTANTS.DELAYS.TOAST_AUTO_HIDE)}hideMessage(e){try{let t=$("#"+e);0!==t.length&&(t.addClass("toast-hide"),setTimeout(()=>{t.remove();var e=$(CONSTANTS.SELECTORS.toastContainer);0===e.children().length&&e.remove()},CONSTANTS.DELAYS.TOAST_HIDE_ANIMATION))}catch(e){console.error("隐藏消息失败:",e)}}initTheme(){try{var e=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");this.setTheme(e)}catch(e){console.error("初始化主题失败:",e),this.setTheme("light")}}setTheme(e){try{["light","dark"].includes(e)||(e="light"),this.state.currentTheme=e,$("html").attr("data-theme",e),localStorage.setItem("theme",e)}catch(e){console.error("设置主题失败:",e)}}toggleMobileMenu(){$(CONSTANTS.SELECTORS.memberSidebar).toggleClass("active"),$(CONSTANTS.SELECTORS.sidebarOverlay).toggleClass("active")}closeMobileMenu(){$(CONSTANTS.SELECTORS.memberSidebar).removeClass("active"),$(CONSTANTS.SELECTORS.sidebarOverlay).removeClass("active")}handleResize(){try{$(window).width()>CONSTANTS.BREAKPOINTS.TABLET&&this.closeMobileMenu()}catch(e){console.error("处理窗口大小改变失败:",e)}}async withButtonLoading(e,t){var e=$(e),o=e.html();try{e.addClass("btn-loading"),e.prop("disabled",!0),e.html('<i class="fa fa-spinner fa-spin"></i> '+o),await t()}finally{e.prop("disabled",!1),e.removeClass("btn-loading"),e.html(o)}}isMobile(){return $(window).width()<=CONSTANTS.BREAKPOINTS.MOBILE}initPhotoViewer(){try{let t=document.getElementById("photoPreview");if(t){let e=document.getElementById("imageLoadingPlaceholder");e&&t.src&&""!==t.src?t.complete&&0!==t.naturalHeight?(e.remove(),t.style.display="block",this.initPhotoSwipe(t)):(t.onload=()=>{e&&e.remove(),t.style.display="block",this.initPhotoSwipe(t)},t.onerror=()=>{e&&(e.innerHTML='<i class="fa fa-exclamation-circle" style="font-size: 40px; color: var(--danger-color);"></i><span style="color: var(--text-secondary); margin-top: 8px;">照片加载失败</span>')}):t.src&&""!==t.src&&this.initPhotoSwipe(t)}}catch(e){console.error("初始化照片查看器失败:",e)}}initPhotoSwipe(t){try{"undefined"==typeof PhotoSwipe||"undefined"==typeof PhotoSwipeUI_Default?console.warn("PhotoSwipe 未加载"):$(t).off("click.photoswipe").on("click.photoswipe",e=>{e.preventDefault(),this.openPhotoSwipe(t)})}catch(e){console.error("初始化 PhotoSwipe 实例失败:",e)}}openPhotoSwipe(a){try{var e=document.querySelectorAll(".pswp")[0],t=[{src:a.src,w:a.naturalWidth||1920,h:a.naturalHeight||1080,title:a.alt||"照片预览"}],o=new PhotoSwipe(e,PhotoSwipeUI_Default,t,{index:0,bgOpacity:.85,showHideOpacity:!0,loop:!1,pinchToClose:!0,closeOnScroll:!1,closeOnVerticalDrag:!0,mouseUsed:!1,escKey:!0,arrowKeys:!0,history:!1,focus:!0,showAnimationDuration:333,hideAnimationDuration:333,getThumbBoundsFn:function(e){var t=a,o=window.pageYOffset||document.documentElement.scrollTop,t=t.getBoundingClientRect();return{x:t.left,y:t.top+o,w:t.width}}});o.init(),this.photoViewer=o}catch(e){console.error("打开 PhotoSwipe 失败:",e)}}}let memberCenter=null;$(document).ready(()=>{try{memberCenter=new MemberCenter,window.memberCenter=memberCenter,console.log("个人中心初始化成功")}catch(e){console.error("个人中心初始化失败:",e)}}),$(window).on("beforeunload",()=>{}),window.addEventListener("error",e=>{console.error("全局错误:",e.error);try{memberCenter&&"function"==typeof memberCenter.showMessage&&memberCenter.showMessage("系统出现错误，请刷新页面","error")}catch(e){}});
//# sourceMappingURL=member.min.js.map