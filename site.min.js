function loadImages(t){var a=[];for(let e=0;e<t.length;e++){let o=t[e];var n=new Promise((e,t)=>{o.complete?e(o):(o.addEventListener("load",function(){(o.complete?e:t)(o)}),o.addEventListener("error",function(){console.warn(`the image [${o.src}] loaded error.`),t(o)}))});a.push(n)}return Promise.all(a)}function lightCode(){document.querySelectorAll("pre code").forEach(e=>{Prism.highlightElement(e)}),codeBlockTools()}function processBlockTools(o){if(0!==o.length&&!o.parent().hasClass("code-area")){o.wrap('<div class="code-area" style="position: relative"></div>');let e=o.parent();var t=$('<i class="fa fa-angle-up fa-fw code-expand" aria-hidden="true" title="折叠"></i>'),t=(e.prepend(t),t.on("click",function(){e.hasClass("code-closed")?(o.find("code").show(),o.find(".line-highlight").show(),$(this).parent().removeClass("code-closed")):(o.find("code").hide(),o.find(".line-highlight").hide(),e.addClass("code-closed"))}),$('<i class="fa fa-copy fa-fw code_copy" title="复制代码" aria-hidden="true"></i>')),a=$('<div class="codecopy_notice"></div>'),a=(e.prepend(t),e.prepend(a),t.on("click",function(){var e=window.getSelection(),t=document.createRange(),t=(t.selectNodeContents(o.find("code")[0]),e.removeAllRanges(),e.addRange(t),e.toString());copy(t,this),e.removeAllRanges()}),$('<div class="code_lang" title="代码语言"></div>'));o.before(a),o.each(function(){var e;for(e of $(this).prop("class").split(/\s+/))if(e.startsWith("language")){var t=e.replace("language-","").trim();$(this).siblings(".code_lang").text(t);break}})}}function codeBlockTools(){var e;for(e of $("pre[class*=language-]"))processBlockTools($(e))}function copy(e,t){if(document.queryCommandSupported&&document.queryCommandSupported("copy"))try{document.execCommand("copy"),layer.msg("复制成功")}catch(e){return layer.msg("复制失败"),!1}else layer.msg("浏览器不支持")}function outPutSuccess(e){console.log(`%c Success %c [${moment().format("YYYY-MM-DD HH:mm:ss")}]  %c `+e,"color: #bb0662; background: #030307; padding:5px 0;","color: #fadfa3; background: #393d49; padding:5px 0","font-weight:bold; color: black; background: #77f2e1; padding:5px 0;")}function outPutInfo(e){console.log(`%c Info %c [${moment().format("YYYY-MM-DD HH:mm:ss")}]  %c `+e,"color: #bb0662; background: #030307; padding:5px 0;","color: #fadfa3; background: #393d49; padding:5px 0","font-weight:bold; color: black; background: #fadfa3; padding:5px 0;")}function outPutError(e){console.log(`%c Error %c [${moment().format("YYYY-MM-DD HH:mm:ss")}]  %c `+e,"color: #bb0662; background: #030307; padding:5px 0;","color: #fadfa3; background: #393d49; padding:5px 0","font-weight:bold; color: black; background: red; padding:5px 0;")}function ajaxFail(e,t,o){console.log(e),console.log(t),console.log(o),e.hasOwnProperty("responseJSON")&&e.responseJSON.hasOwnProperty("success")&&e.responseJSON.hasOwnProperty("msg")&&!1===e.responseJSON.success?layer.alert(e.responseJSON.msg):layer.msg("error:"+e.status)}(async()=>{var e;moment.locale("zh-cn"),new LazyLoad({}),"granted"!==Notification.permission&&(e=await Notification.requestPermission(function(e){"granted"===e&&console.info("通知已授权")}),console.log(e))})(),$.fn.relativeTime=function(){this.each(function(e){var t,o;void 0===$(this).data("timeStatus")&&(o=$(this).attr("datetime"),t=$(this).text(),o=moment(o,"YYYY/MM/DD HH:mm:ss").fromNow(),$(this).text(o).attr("title",t).data("timeStatus","loaded"))})};let videoItems=[];async function initVideoPlayer(){var e,t=document.getElementById("video-player")||document.getElementById("m-video-player"),t=(null!==t&&(0===videoItems.length&&(e=await fetch(dpzOption.webApiBaseAddress+"/api/Video",{method:"GET",headers:{"Content-Type":"application/json"},mode:"cors"}),videoItems=await e.json()),t.style.marginBottom="1em",window.innerWidth<=550&&(t.style.marginBottom="4em"),t.style.aspectRatio="16/9",e=Math.floor(Math.random()*videoItems.length),videoPlayer(t,videoItems[e].m3u8,videoItems[e].id)),document.querySelector("[data-watch-video]"));null!==t&&(e=JSON.parse(t.dataset.watchVideo),t.style.marginBottom="1em",t.style.aspectRatio="16/9",videoPlayer(t,e.url,e.id))}function videoPlayer(e,t,o){new Artplayer({container:e,url:t,type:"m3u8",fullscreenWeb:!0,fullscreen:!0,customType:{m3u8:function(t,o,a){if(Hls.isSupported()){a.hls&&a.hls.destroy();let e=new Hls;e.loadSource(o),e.attachMedia(t),a.hls=e,a.on("destroy",()=>e.destroy())}else t.canPlayType("application/vnd.apple.mpegurl")?t.src=o:a.notice.show="Unsupported playback format: m3u8"}},plugins:[artplayerPluginDanmuku({danmuku:async function(){return(await fetch("/history/danmaku/v2/"+o)).json()}})],controls:[]}).on("artplayerPluginDanmuku:emit",async e=>{e.id=o,await fetch("/send/danmaku/v2",{method:"post",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)})})}async function initFetchContent(){var e,t;for(e of document.querySelectorAll("[data-request]"))"loaded"!==e.dataset.status&&(t=await fetch(e.dataset.request,{method:"GET"}),e.dataset.status="loaded",e.innerHTML=await t.text(),$("time.timeago").relativeTime(),lightCode())}function generateToc(){var e=$(".js-toc");0!==e.length&&(0===$(".article-detail-content").find("h1,h2,h3").length?(tocbot.destroy(),$("label.toc-icon.menu").hide(),e.hide()):tocbot.init({tocSelector:".js-toc",contentSelector:".article-detail-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0}))}let dpzOption={webApiBaseAddress:document.querySelector("meta[name=web-api-base-address]").content,CDNBaseAddress:document.querySelector("meta[name=cdn-base-address]").content,isDark:window.matchMedia("(prefers-color-scheme: dark)").matches};function leftIn(){$(".blog-mask").unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend"),$(".blog-nav-left").unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend"),$(".blog-mask").removeClass("maskOut"),$(".blog-mask").addClass("maskIn"),$(".blog-mask").removeClass("layui-hide"),$(".blog-mask").addClass("layui-show"),$(".blog-nav-left").removeClass("leftOut"),$(".blog-nav-left").addClass("leftIn"),$(".blog-nav-left").removeClass("layui-hide"),$(".blog-nav-left").addClass("layui-show")}function leftOut(){$(".blog-mask").on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(".blog-mask").addClass("layui-hide")}),$(".blog-nav-left").on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(".blog-nav-left").addClass("layui-hide")}),$(".blog-mask").removeClass("maskIn"),$(".blog-mask").addClass("maskOut"),$(".blog-mask").removeClass("layui-show"),$(".blog-nav-left").removeClass("leftIn"),$(".blog-nav-left").addClass("leftOut"),$(".blog-nav-left").removeClass("layui-show")}function categoryToggleV2(){var e=$(".right-category-nav-v2");$(".right-category-toggle-v2"),$(".right-category-mask-v2");(e.hasClass("category-visible-v2")?categoryOutV2:categoryInV2)()}function categoryInV2(){let e=$(".right-category-nav-v2");var t=$(".right-category-toggle-v2"),o=$(".right-category-mask-v2");e.unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend"),o.addClass("mask-visible-v2"),e.removeClass("category-hidden-v2 category-slide-out-v2"),e.addClass("category-visible-v2 category-slide-in-v2"),e.show(),t.addClass("toggle-active-v2"),e.on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){e.removeClass("category-slide-in-v2"),e.unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend")})}function categoryOutV2(){let e=$(".right-category-nav-v2");var t=$(".right-category-toggle-v2"),o=$(".right-category-mask-v2");e.hasClass("category-visible-v2")&&(o.removeClass("mask-visible-v2"),e.removeClass("category-slide-in-v2"),e.addClass("category-slide-out-v2"),t.removeClass("toggle-active-v2"),e.on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){e.removeClass("category-visible-v2 category-slide-out-v2"),e.addClass("category-hidden-v2"),e.hide(),e.unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend")}))}function categroyIn(){categoryInV2()}function categoryOut(){categoryOutV2()}function pjaxCompleteInit(){lightCode(),generateToc(),$("time.timeago").relativeTime(),initVideoPlayer().catch(e=>console.log(e)),initFetchContent().catch(e=>console.log(e)),window.innerWidth<=768&&initMobileSearch(),initSteamAchievements()}async function showNotify(e){var t,o;return"Notification"in window&&(t=await Notification.requestPermission(),o={title:"",content:"",image:"https://cdn.dpangzi.com/logo.png"},$.extend(o,e),"granted"===t)?new Notification(o.title,{icon:o.image,body:o.content,lang:"zh-cn",tag:o.tag}):null}dpzOption.isDark&&document.querySelector("#layui_theme_css").setAttribute("href",dpzOption.CDNBaseAddress+"/lib/layui/css/layui-theme-dark.css"),(async()=>{var e=await(await fetch("/account/GetUserInfo")).json();e.success&&$(".blog-user").attr("href","/account").find("img").attr({src:""+e.data.avatar,title:e.data.name});let i=".article.shadow .article-left img,.mumble-list .mumble-item .mumble-content img,.article-detail-content img,#cd-timeline .content img",t=($(document).delegate(i,"click",function(){let e=layer.load(1),n=$(i);loadImages(n).then(t=>{var o=[];for(let e=0;e<t.length;e++){var a=t[e];o.push({src:a.src,w:a.naturalWidth,h:a.naturalHeight,title:a.alt})}var e={index:n.index(this),bgOpacity:.7,showHideOpacity:!0,history:!0,getThumbBoundsFn:function(e){var e=document.querySelectorAll(i)[e],t=window.pageYOffset||document.documentElement.scrollTop,e=e.getBoundingClientRect();return{x:e.left,y:e.top+t,w:e.width}}};new PhotoSwipe(document.getElementById("gallery"),PhotoSwipeUI_Default,o,e).init()}).finally(()=>layer.close(e))}),$(document).delegate("#i-search","submit",function(){var e=$("#i-keyword").val(),t=$(this).find("[name=q]");$(this).find("[name=q]").val(t.data("default")+" "+e)}),$(document).delegate("#i-keyword","keyup",function(e){13===e.keyCode&&$(this).parents("form").submit()}),$(document).delegate("#i-search a.search-btn","click",function(){$(this).parents("form").submit()}),$(document).delegate("[title]:not(.react-jinke-music-player-main *)","touchend",function(){var e=$(this).attr("title");layer.tips(e,this,{tips:3})}),e=await(await fetch("/Music/Recommend/v2")).json(),ReactJkMusicPlayer.defaultProps.quietUpdate=!0,ReactJkMusicPlayer.defaultProps.locale="zh_CN",ReactJkMusicPlayer.defaultProps.defaultPosition={bottom:0,left:0},ReactJkMusicPlayer.defaultProps.preload=!0,ReactJkMusicPlayer.defaultProps.glassBg=!0,ReactJkMusicPlayer.defaultProps.autoPlay=!1,ReactJkMusicPlayer.defaultProps.remove=!1,ReactJkMusicPlayer.defaultProps.showMiniProcessBar=!0,ReactJkMusicPlayer.defaultProps.showDownload=!1,ReactJkMusicPlayer.defaultProps.showLyric=!0,ReactJkMusicPlayer.defaultProps.showMediaSession=!0,ReactJkMusicPlayer.defaultProps.showDestroy=!1,ReactJkMusicPlayer.defaultProps.showReload=!1,ReactJkMusicPlayer.defaultProps.volumeFade={fadeIn:300,fadeOut:300},ReactJkMusicPlayer.defaultProps.sortableOptions={disabled:!0,forceFallback:!0},ReactJkMusicPlayer.defaultProps.audioLists=e,ReactDOM.render(React.createElement(ReactJkMusicPlayer),document.getElementById("music-player")),null);function o(e){clearTimeout(t),t=setTimeout(function(){0<window.scrollY?$(".blog-nav").css({"background-color":"rgba(57,61,73,.5)","backdrop-filter":"blur(25px)"}):0===window.scrollY&&$(".blog-nav").css({"background-color":"rgb(57,61,73)","backdrop-filter":"none"})},100)}$(window).off("scroll",o).on("scroll",o)})(),layui.use(["element","layer","carousel","util","flow","form","upload"],function(){let t=layui.layer,e=layui.flow,o=layui.util;if(o.fixbar({bar1:"&#xe64a;",css:{bottom:55},click:function(e){if("bar1"===e){let e=t.load(),a=(console.log(event),event.target||event.srcElement);$.ajax({url:"/Home/TodayWallpaper"}).done(function(e){var t,o=[];for(t of e)o.push({src:t.url.replaceAll("1920x1080","UHD"),w:1920,h:1080,title:t.copyRight});e={index:0,bgOpacity:.7,showHideOpacity:!0,history:!0,getThumbBoundsFn:function(e){var t=window.pageYOffset||document.documentElement.scrollTop,o=a.getBoundingClientRect()||{left:0,top:0,width:0};return{x:o.left,y:o.top+t,w:o.width}}};new PhotoSwipe(document.getElementById("gallery"),PhotoSwipeUI_Default,o,e).init()}).always(function(){t.close(e)})}}}),e.lazyimg(),!1===layui.device().mobile)try{let t=document.querySelector("#can-back-round");var a=t.getBoundingClientRect();t.width=a.width,t.height=a.height;let o=new RaindropFX({canvas:t,background:dpzOption.isDark?"https://cdn.dpangzi.com/wallpaper.jpg":dpzOption.CDNBaseAddress+"/../images/background.jpg"});window.onresize=()=>{var e=t.getBoundingClientRect();o.resize(e.width,e.height)},o.start()}catch(e){console.log(e)}}),$(document).delegate(".blog-navicon","click",function(){(new RegExp("layui-hide").test($(".blog-nav-left").attr("class"))?leftIn:leftOut)()}),$(document).delegate(".blog-mask","click",function(){leftOut()}),$(document).delegate(".right-category-toggle-v2","click",function(){categoryToggleV2()}),$(document).delegate(".right-category-mask-v2","click",function(){categoryOutV2()}),$(document).delegate(".right-category-tag-v2","click",function(){$(".right-category-tag-v2").removeClass("right-category-tag-active-v2"),$(this).addClass("right-category-tag-active-v2")}),$(window).resize(function(){768<$(window).width()&&categoryOutV2()}),layui.use(["element"],function(){let o=layui.element,a=layui.form,n=void($.pjax.defaults.timeout=2e4,$(document).pjax("nav.blog-nav ul.layui-nav>li>a,a[data-pjax]",".blog-body"),$(document).pjax("#blog-list a,a.right-category-tag-v2",".blog-main-left"),$(document).pjax("#articl-comment a","#blog-comment",{scrollTo:!1}),$(document).pjax("#talk-pager a",".mumble-list"),$(document).pjax("#topic-list a",".blog-main-left"),$(document).pjax(".bookmark .category-box a.category",".blog-body"),$(document).pjax(".code-box .box-rows .row .header a",".code-box .box-rows"),$.support.pjax&&$(".tags a").on("click",function(e){$(".tags a").removeClass("tag-this"),$(this).addClass("tag-this");$.pjax.click(e,{container:".blog-main-left"})}),pjaxCompleteInit(),$(document).on("pjax:send",function(){NProgress.start()})),e=($(document).on("pjax:complete",function(e,t){""===(n=t.getResponseHeader("title"))||null===n?document.title="（；´д｀）ゞ标题不见啦 - 叫我阿胖":document.title=Base64.decode(n),o.render(),a.render(),categoryOut(),leftOut(),pjaxCompleteInit(),NProgress.done()}),new LazyLoad({}));$(document).on("pjax:end",function(){e.update()})}),(async()=>{let e=(new signalR.HubConnectionBuilder).withUrl("/notification",{skipNegotiation:!0,transport:signalR.HttpTransportType.WebSockets}).withAutomaticReconnect().build();try{await e.start(),await e.invoke("Init")}catch(e){console.error(e)}e.on("pushMessage",async function(e){var t=await showNotify({title:"小喇叭开始广播辣",content:e.markdown});null!==t&&(t.onclick=function(){window.open("/talk.html")}),console.info(e)}),e.on("pushLogMessage",function(e,t){0===e?(outPutSuccess(t),$.notify(moment().format("YYYY-MM-DD HH:mm:ss")+`
`+t,"success")):1===e?(outPutInfo(t),$.notify(moment().format("YYYY-MM-DD HH:mm:ss")+`
`+t,"warn")):2===e&&(outPutError(t),$.notify(moment().format("YYYY-MM-DD HH:mm:ss")+`
`+t,"error"))});let n=null;function o(){e.invoke("getRunTime")}e.on("cnBetaSubscribe",function(t){var o=[];if(t.hasOwnProperty("progressValues")&&Array.isArray(t.progressValues))for(let e=0;e<t.progressValues.length;e++){var a=(100*t.progressValues[e]).toFixed(2);o.push(parseFloat(a))}switch(null==n?n=notification.show({title:"CnBeta发布",content:t.message,bars:o}):(notification.setContent(n,t.message),notification.setProgress(n,o)),t.type){case 0:outPutSuccess(t.message);break;case 1:outPutInfo(t.message);break;case 2:outPutError(t.message);break;case 3:outPutSuccess(t.message),setTimeout(function(){notification.close(n),n=null},1e3)}}),e.on("ready",function(e){console.info(e)}),setTimeout(function(){o()},1e3),e.on("ReceiveRunTime",function(e){var t=$("#runTime");0<t.length&&(t.text("运行时间 "+e),setTimeout(o,1e3))}),e.on("systemNotification",function(e){layer.msg(e)})})(),(async()=>{var e=(new signalR.HubConnectionBuilder).withUrl("/app/notification",{skipNegotiation:!0,transport:signalR.HttpTransportType.WebSockets}).withAutomaticReconnect().build();try{await e.start()}catch(e){console.error(e)}e.on("systemMessage",function(e,t){0===e?(outPutSuccess(t),$.notify(t,"success")):1===e?(outPutInfo(t),$.notify(t,"warn")):2===e&&(outPutError(t),$.notify(t,"error"))})})();let notification={_instances:new Set,show:function(e){var e={title:"",content:"",bars:[],autoClose:0,type:"info",...e=e&&"object"==typeof e?e:{}},t=this._calculateTopPosition();let o=this._createBox(e);return o.css("top",t+"px"),$("body").append(o),this._instances.add(o[0]),0<e.autoClose&&setTimeout(()=>this.close(o),e.autoClose),requestAnimationFrame(()=>{o.addClass("notification-enter")}),o},setContent:function(e,t){this._validateBox(e)&&0<(e=e.find(".content")).length&&e.text(String(t||""))},setTitle:function(e,t){this._validateBox(e)&&0<(e=e.find(".title")).length&&e.text(String(t||""))},setProgress:function(e,t){if(this._validateBox(e)&&Array.isArray(t)){let o=e.find(".content-container .progress .bar");t.forEach((e,t)=>{"number"==typeof e&&t<o.length&&(e=Math.max(0,Math.min(100,e)),o.eq(t).css("width",e+"%").text(e.toFixed(1)+"%"))})}},close:function(e){this._validateBox(e)&&(e.addClass("notification-exit"),setTimeout(()=>{e[0]&&(this._instances.delete(e[0]),e.remove(),this._recalculatePositions())},300))},closeAll:function(){Array.from(this._instances).forEach(e=>{e=$(e);0<e.length&&this.close(e)})},getActiveCount:function(){return this._instances.size},test:function(){let e=this.show({title:"测试通知",content:"正在加载...",bars:[0],type:"info"}),t=0,o=setInterval(()=>{100<=t?(this.setContent(e,"加载完毕，即将关闭！"),clearInterval(o),setTimeout(()=>this.close(e),1e3)):(t+=2,this.setContent(e,`进度: ${t}%`),this.setProgress(e,[t]))},50)},_validateBox:function(e){return e&&0<e.length&&this._instances.has(e[0])},_calculateTopPosition:function(){let t=15;return this._instances.forEach(e=>{e=$(e);e.is(":visible")&&(t+=e.outerHeight(!0)+15)}),t},_recalculatePositions:function(){let t=15;this._instances.forEach(e=>{e=$(e);e.is(":visible")&&(e.css("top",t+"px"),t+=e.outerHeight(!0)+15)})},_createBox:function(e){var t=$("<div>").addClass("notification-box notification-"+e.type),o=(e.title&&(o=$("<div>").addClass("title").text(e.title),t.append(o)),$("<div>").addClass("content-container")),a=$("<div>").addClass("content").text(e.content);return o.append(a),this._createProgressBars(o,e.bars),t.append(o),this._addCloseButton(t),t},_createProgressBars:function(o,e){Array.isArray(e)&&0!==e.length&&e.forEach(e=>{var t;"number"==typeof e&&(e=Math.max(0,Math.min(100,e)),t=$("<div>").addClass("progress"),e=$("<div>").addClass("bar").css("width",e+"%").text(e.toFixed(1)+"%"),t.append(e),o.append(t))})},_addCloseButton:function(t){var e=$("<button>").addClass("notification-close").html("&times;").attr("aria-label","关闭通知").on("click",e=>{e.preventDefault(),e.stopPropagation(),this.close(t)});t.append(e)}},layImConfig=((()=>{function e(){$(".bookmark-item .bookmark-card").each(function(){var e=$(this),t=e.children("img").filter(":not(.bookmark-icon)"),o=e.find("img[data-src]:not(.bookmark-icon)");0<t.length||0<o.length?e.removeClass("no-image"):e.addClass("no-image")})}$(document).ready(function(){e()}),$(document).on("pjax:complete",function(){setTimeout(e,100)}),$(document).on("load",".bookmark-card img:not(.bookmark-icon)",function(){e()}),$(document).on("lazyloaded",".bookmark-card img:not(.bookmark-icon)",function(){e()});let n="";$(document).delegate(".bookmark .search-box input[type=search]","input",function(){n=$(this).val();let e=[];$(".bookmark .category-box .category.active").each(function(){e.push($(this).text())}),$.ajax({type:"get",url:"/bookmark/search",traditional:!0,data:{title:n,categories:e}}).done(function(e){if(e.success){$(".bookmark .search-box .search-result").show();var t,o=[];for(t of e.data)o.push(`<li>${t}</li>`);$(".bookmark .search-box .search-result ul").html(o.join(""))}})}),$(document).delegate(".bookmark .search-box input[type=search]","keyup",function(t){if(13===t.keyCode){t=$(this).val();let e=[];$(".bookmark .category-box .category.active").each(function(){e.push("categories="+encodeURIComponent($(this).text()))}),""===t.trim()&&0===e.length?$.pjax({url:"/bookmark.html",container:".blog-body"}):""===t.trim()&&0!==e.length?$.pjax({url:"/bookmark.html?"+e.join("&"),container:".blog-body"}):""!==t.trim()&&0===e.length?$.pjax({url:"/bookmark.html?title="+encodeURIComponent(t),container:".blog-body"}):$.pjax({url:`/bookmark.html?title=${encodeURIComponent(t)}&`+e.join("&"),container:".blog-body"})}}),$(document).delegate(".bookmark .search-box .search-result ul li","click",function(){var e=$(this).text();let t=[];$(".bookmark .category-box .category.active").each(function(){t.push("categories="+encodeURIComponent($(this).text()))}),0===t.length?$.pjax({url:"/bookmark.html?title="+encodeURIComponent(e),container:".blog-body"}):$.pjax({url:`/bookmark.html?title=${encodeURIComponent(e)}&`+t.join("&"),container:".blog-body"})}),$(document).delegate(".bookmark .search-box input[type=search]","blur",function(){setTimeout(function(){$(".bookmark .search-box .search-result").hide()},300)}),$(document).delegate(".bookmark .search-box input[type=search]","focus ",function(){0<$(".bookmark .search-box .search-result ul li").length&&$(".bookmark .search-box .search-result").show()}),$(document).delegate(".bookmark .search-box input[type=search]","keydown",function(e){var t,o=$(".bookmark .search-box .search-result ul li"),a=$(".bookmark .search-box .search-result ul li.selected");40===e.keyCode?(e.preventDefault(),0===a.length?((t=o.first()).addClass("selected"),$(this).val(t.text())):$(".bookmark .search-box .search-result ul li:last").hasClass("selected")?(o.removeClass("selected"),$(this).val(n)):(t=a.next(),o.removeClass("selected"),0<t.length&&(t.addClass("selected"),$(this).val(t.text())))):38===e.keyCode&&(e.preventDefault(),0===a.length?((t=o.last()).addClass("selected"),$(this).val(t.text())):$(".bookmark .search-box .search-result ul li:first").hasClass("selected")?(o.removeClass("selected"),$(this).val(n)):(e=a.prev(),o.removeClass("selected"),0<e.length&&(e.addClass("selected"),$(this).val(e.text()))))}),$(document).delegate(".bookmark .category-box .category","click",function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active")}),$(document).delegate("form.bookmark-create","submit",function(){var e=new FormData(this);let a=$(this);return $(this).find("button[lay-submit]").addClass("layui-btn-disabled").attr("disabled","disabled").html('<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop layui-font-12"></i> 正在提交'),$.ajax({url:a.attr("action"),processData:!1,contentType:!1,data:e,type:"post"}).done(function(e,t,o){e.success?(a[0].reset(),layer.closeAll(),$.pjax({url:"/bookmark.html",container:".blog-body"})):layer.alert(e.msg)}).fail(ajaxFail),!1}),layui.use(["element","layer","carousel","util","flow","form","upload"],function(){let a=layui.form;$(document).delegate(".bookmark-setting[data-id]","click",function(){var e=$(this).data("id");let t=layer.load(),o=600<$(window).width()?"600px":"100%";$.ajax({url:"/bookmark/update/"+e,type:"get"}).done(function(e){"object"==typeof e?e.success||layer.msg(e.msg):layer.open({type:1,content:e,area:o,success:function(){a.render()}})}).always(function(){layer.close(t)}).fail(ajaxFail)})}),$(document).delegate("form.bookmark-create button[data-delete]","click",function(){let e=layer.load();$.ajax({url:"/bookmark/delete",type:"post",data:{id:$(this).data("delete")}}).done(function(){layer.closeAll(),$.pjax({url:"/bookmark.html",container:".blog-body"})}).always(function(){layer.close(e)})})})(),(()=>{var e;function c(e,t){var o={loading:{class:"ds-button-loading",disabled:!0,html:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12a9 9 0 11-6.219-8.56"></path>
                </svg> 发送中...`},normal:{class:"",disabled:!1,html:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                </svg> 发送`},error:{class:"ds-button-error",disabled:!1,html:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg> 重试`}},t=o[t]||o.normal;e.removeClass("ds-button-loading ds-button-error"),t.class&&e.addClass(t.class),t.disabled?e.attr("disabled","disabled"):e.removeAttr("disabled"),e.html(t.html)}document.getElementById("comment-loading-styles")||((e=document.createElement("style")).id="comment-loading-styles",e.textContent=`
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
            
            .ds-button-loading {
                position: relative;
                pointer-events: none;
                opacity: 0.8;
            }
            
            .ds-button-loading svg {
                animation: spin 1s linear infinite;
            }
            
            .ds-button-error {
                background-color: #ef4444;
                border-color: #dc2626;
                color: white;
            }
            
            .ds-button-error:hover {
                background-color: #dc2626;
                border-color: #b91c1c;
            }
        `,document.head.appendChild(e)),$(document).delegate(".comments-area .load-more .ds-button","click",function(){let a=$(this).parents(".comments-area"),n=$(this).parent(),i=$(this).parents().find(".comment-count span");var e=$(this).parent().data("loadingIco"),e=(n.html(`<img src="${e}" class="comment-loading" alt="loading"/>`),parseInt($(this).data("pageIndex"))),t=parseInt($(this).data("pageSize")),o=$(this).data("pageRequest");$(this);$.ajax({url:o,type:"get",data:{pageIndex:e+1,pageSize:t}}).done(function(e,t,o){a.append(e),n.remove(),i.text(o.getResponseHeader("commentCount")),$("time.timeago").relativeTime(),lightCode()}).fail(function(){layer.msg("加载更多评论失败",{icon:2,anim:6}),"function"==typeof ajaxFail&&ajaxFail.apply(this,arguments)})}),$(document).delegate("form.comment-form :input:not(textarea)","keydown",function(e){return"Enter"!==e.key}),$(document).delegate("form.comment-form","submit",function(){event.preventDefault();var e=new FormData(this);let s=$(this),l=$(this).parents(".comment-block").find(".comment-count span"),r=$(this).find("button.ds-button");c(r,"loading"),$.ajax({url:s.attr("action"),processData:!1,contentType:!1,data:e,type:"post"}).done(function(e,t,o){var a,n,i;e.hasOwnProperty("success")&&!1===e.success?(layer.msg(e.msg,{icon:2,anim:6}),c(r,"error"),setTimeout(()=>{c(r,"normal")},3e3)):(n=(a=s.parents(".comment-block")).find(".comments-area:first"),(i=s.clone()).find("textarea").val(""),c(i.find("button.ds-button"),"normal"),i.find("input[name=replyId]").val(""),i.find(".comment-btn-close").hide(),i.find(".comment-btn-close").off("click"),a.find(".comments-area").html(e),s.remove(),n.before(i),l.text(o.getResponseHeader("commentCount")),$("time.timeago").relativeTime(),lightCode())}).fail(function(){c(r,"error"),layer.msg("提交失败，请检查网络连接",{icon:2,anim:6}),setTimeout(()=>{c(r,"normal")},3e3)}).always(function(){r.hasClass("ds-button-error")||r.hasClass("ds-button-loading")||c(r,"normal")})}),$(document).delegate(".comment-count button.refresh","click",function(){let a=$(this).parents(".comment-block").find(".comments-area");var e=$(this).data("refresh")+"?t="+(new Date).getTime();let n=$(this).parent().find("span");var t=a.find("form.comment-form");let i=null,s=!1,o=(0<t.length&&(i=t.clone(),s=!0,i.find("input[name=replyId]").val(""),i.find(".comment-btn-close").hide(),c(i.find("button.ds-button"),"normal")),layer.load());$.ajax({url:e,type:"get"}).done(function(e,t,o){a.html(e),n.text(o.getResponseHeader("commentCount")),s&&i&&a.before(i),$("time.timeago").relativeTime(),lightCode()}).fail(function(){layer.msg("刷新评论失败",{icon:2,anim:6}),s&&i&&a.before(i),"function"==typeof ajaxFail&&ajaxFail.apply(this,arguments)}).always(function(){layer.close(o)})}),$(document).delegate(".footer-action-item[data-image]","click",function(){let a=$(this).parents().find("textarea.comment-form-editor");layer.prompt({title:"请输入网络图片地址"},function(e,t){let o;try{o=new URL(e)}catch{return void layer.msg("请输入正确的地址嗷~")}"https:"!==o.protocol?layer.msg("使用https协议的网络图片嗷~"):(e=`![](${o.toString()})`,a.val(a.val()+"\r\n"+e),layer.close(t))})}),$(document).delegate(".comments-area .comment-item button.btn-reply","click",function(){var e=$(this).parents(".comment-block");let t=$(this).parents(".comments-area");var o=$(this),a=$(this).data("replyId"),e=e.find("form.comment-form");let n;0===e.length?layer.msg("评论表单未找到，请刷新页面重试",{icon:2,anim:6}):(0<t.find("form.comment-form").length?n=t.find("form.comment-form").first():(c((n=e.clone()).find("button.ds-button"),"normal"),e.remove()),n.find("input[name=replyId]").val(a),n.find(".comment-btn-close").show(),n.find(".comment-btn-close").off("click").on("click",function(){n.find("input[name=replyId]").val(""),n.find("textarea").val(""),c(n.find("button.ds-button"),"normal"),t.before(n),$(this).hide()}),o.parents(".comment-block .comment-item:first").find(".detail > .comment-content:first").after(n))}),$(document).ready(function(){$(".comment-block").each(function(){0===$(this).find("form.comment-form").length&&console.warn("Comment form missing, this should not happen in normal operation")})}),console.log("Comment system v2.0 initialized with Design System styles")})(),$(document).delegate("[data-likeid]","click",function(){let t=$(this),e=layer.load(1);$.ajax({url:"/Talk/Like",data:{id:t.data("likeid")},type:"post"}).done(function(e){e.success?t.find("[data-number]").text(e.data):layer.msg(e.msg,{icon:2,anim:6})}).always(function(){layer.close(e)})}),$(document).delegate(".mumble-more a","click",function(){var e=$(this).parents(".mumble-more"),t=$(this).parents(".mumble-item").find(".mumble-content");e.hasClass("mumble-pack-up")?(e.removeClass("mumble-pack-up"),t.addClass("mumble-hide-sub"),$(this).html('查看更多<i class="layui-icon layui-icon-down">')):(e.addClass("mumble-pack-up"),t.removeClass("mumble-hide-sub"),$(this).html('收起<i class="layui-icon layui-icon-up">'))}),$(document).delegate("[data-comment-id]","click",function(){let a=$(this),n=a.parents("div.mumble-item").find("div.mumble-comment[data-talk-id]");if(n.hide("fast",function(){$(this).html("")}),a.parent().hasClass("mumble-active"))a.parent().removeClass("mumble-active");else{a.parent().addClass("mumble-active");let e=layer.load(1);$.ajax({url:"/Comment/Mumble/"+a.data("commentId"),type:"get"}).done(function(e,t,o){a.find("[data-comment-count]").text(o.getResponseHeader("commentCount")),n.html(e),lightCode(),n.show(),a.parents(".comment-parent").find("time.timeago").relativeTime()}).always(function(){layer.close(e)})}}),{contactsPanel:{showFriend:!0,showGroup:!0,minStatus:!0},pageurl:{chatlog:"/chat/record"},init:{url:"/chat/init"},theme:dpzOption.isDark?"dark":"light"}),chatTools=[{name:"code",title:"插入代码",icon:"layui-icon-fonts-code",onClick:function(o){layer.prompt({title:"插入代码",formType:2},function(e,t){layer.close(t),e=["```",e,"```"].join("\n"),o.insert(e)})}}],converter=new showdown.Converter({openLinksInNewWindow:!0,simplifiedAutoLink:!0,splitAdjacentBlockquotes:!0,strikethrough:!0,tables:!0,tasklists:!0});async function loadMembers(e){var t=await(await fetch("/chat/groupMembers/"+e.receiver.id,{method:"GET"})).json();e.render(t.data)}async function getSignalRConnection(e){e=(new signalR.HubConnectionBuilder).withUrl(e,{skipNegotiation:!0,transport:signalR.HttpTransportType.WebSockets}).withAutomaticReconnect().build();try{await e.start()}catch(e){console.error(e)}return e}function log(...e){console.log("[移动端搜索]",...e)}function initMobileSearch(){768<window.innerWidth?log("当前为桌面端，跳过移动端搜索初始化"):(log("当前为移动端，开始初始化移动端搜索功能"),createMobileSearchElements(),bindMobileSearchEvents())}function createMobileSearchElements(){if(document.querySelector(".mobile-search-trigger"))log("移动端搜索触发器已存在，跳过创建");else{log("开始创建移动端搜索元素...");var t=document.createElement("div"),e=(t.className="mobile-search-trigger",t.innerHTML=`
            <div class="mobile-search-trigger-content">
                <i class="fa fa-search mobile-search-trigger-icon"></i>
                <span class="mobile-search-trigger-text">搜索文章、标签或内容...</span>
                <span class="mobile-search-trigger-shortcut">⌘K</span>
            </div>
        `,t.setAttribute("aria-label","打开搜索"),t.setAttribute("role","button"),t.setAttribute("tabindex","0"),document.createElement("div")),o=(e.className="mobile-search-overlay",document.createElement("div")),a=(o.className="mobile-search-container",o.innerHTML=`
            <button class="mobile-search-close" aria-label="关闭搜索">
                <i class="fa fa-times"></i>
            </button>
            <form class="mobile-search-form" action="/Article/Search" method="get">
                <input type="text" class="mobile-search-input" name="keyword" placeholder="搜索文章、标签、内容..." autocomplete="off">
                <button type="submit" class="mobile-search-btn" aria-label="搜索">
                    <i class="fa fa-search"></i>
                </button>
            </form>
        `,document.querySelector(".blog-main-left,.home-main-left-v2"));if(log("找到 .blog-main-left:",!!a),a){var n=a.querySelector(".article"),i=a.querySelector(".blog-search");log("找到 .blog-search:",!!i),log("找到 .article:",!!n);let e=null;i&&i.parentNode===a&&(i=i.nextElementSibling)&&i.parentNode===a&&log("插入位置：桌面搜索框后的元素",(e=i).tagName),!e&&n&&n.parentNode===a&&(e=n,log("插入位置：第一篇文章前")),e?(a.insertBefore(t,e),log("成功插入移动端搜索触发器")):(a.appendChild(t),log("追加移动端搜索触发器到末尾"))}else{log("未找到 .blog-main-left，使用备用方案");i=document.querySelector(".blog-main");i?(n=i.firstElementChild)?(i.insertBefore(t,n),log("插入到 .blog-main 开头")):(i.appendChild(t),log("追加到 .blog-main")):(document.body.appendChild(t),log("插入到 body"))}document.body.appendChild(e),document.body.appendChild(o),e.style.display="none",e.style.visibility="hidden",o.style.display="none",o.style.visibility="hidden",log("移动端搜索元素创建完成并设置为隐藏状态")}}function bindMobileSearchEvents(){var e=document.querySelector(".mobile-search-trigger");let t=document.querySelector(".mobile-search-overlay"),o=document.querySelector(".mobile-search-container");var a=document.querySelector(".mobile-search-close");let n=document.querySelector(".mobile-search-input"),i=document.querySelector(".mobile-search-form");function s(){t.style.display="block",t.style.visibility="visible",o.style.display="block",o.style.visibility="visible",requestAnimationFrame(()=>{t.classList.add("active"),o.classList.add("active"),setTimeout(()=>{n.focus()},300)}),document.body.style.overflow="hidden",log("搜索框已打开")}function l(){t.classList.remove("active"),o.classList.remove("active"),document.body.style.overflow="",setTimeout(()=>{t.classList.contains("active")||(t.style.display="none",t.style.visibility="hidden",o.style.display="none",o.style.visibility="hidden",n.value="",n.blur())},300),log("搜索框已关闭")}e&&t&&o&&a&&n&&i&&(e.addEventListener("click",s),a.addEventListener("click",l),t.addEventListener("click",l),i.addEventListener("submit",function(e){e.preventDefault(),(e=n.value.trim())?(e=i.action+"?keyword="+encodeURIComponent(e),window.location.href=e):(n.focus(),n.style.animation="shake 0.5s",setTimeout(()=>{n.style.animation=""},500))}),document.addEventListener("keydown",function(e){"Escape"===e.key&&o.classList.contains("active")&&l(),!e.ctrlKey&&!e.metaKey||"k"!==e.key||o.classList.contains("active")||(e.preventDefault(),s())}),o.addEventListener("click",function(e){e.stopPropagation()}),window.addEventListener("resize",function(){var e;768<window.innerWidth?(o.classList.contains("active")&&l(),(e=document.querySelector(".mobile-search-trigger"))&&(e.style.display="none"),log("切换到桌面端，隐藏移动端搜索功能")):((e=document.querySelector(".mobile-search-trigger"))&&(e.style.display="block"),log("切换到移动端，显示移动端搜索功能"))}))}function addShakeAnimation(){var e;document.querySelector("#mobile-search-animations")||((e=document.createElement("style")).id="mobile-search-animations",e.textContent=`
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
                20%, 40%, 60%, 80% { transform: translateX(3px); }
            }
            
            .mobile-search-input {
                will-change: transform;
            }
        `,document.head.appendChild(e))}function initSteamAchievements(){var e=$(".category-toggle");0!==e.length&&e.each(function(){var e=$(this),t=e.closest(".achievement-category-section"),o=t.attr("data-category"),a=localStorage.getItem("steam-achievements-"+o),t=t.find(".category-content"),n=e.find(".toggle-icon");null!==a?"collapsed"===a?(t.addClass("collapsed"),e.addClass("collapsed"),n.removeClass("layui-icon-down").addClass("layui-icon-right")):(t.removeClass("collapsed"),e.removeClass("collapsed"),n.removeClass("layui-icon-right").addClass("layui-icon-down")):"unlocked"===o?(t.removeClass("collapsed"),e.removeClass("collapsed"),n.removeClass("layui-icon-right").addClass("layui-icon-down"),localStorage.setItem("steam-achievements-"+o,"expanded")):(t.addClass("collapsed"),e.addClass("collapsed"),n.removeClass("layui-icon-down").addClass("layui-icon-right"),localStorage.setItem("steam-achievements-"+o,"collapsed"))})}layui.config({layimPath:dpzOption.CDNBaseAddress+"/lib/layim/",layimResPath:dpzOption.CDNBaseAddress+"/lib/layim/res/"}).extend({layim:dpzOption.CDNBaseAddress+"/lib/layim/layim"}).use(["layim","layer"],async function(){if(!0!==layui.device().mobile){let t=layui.layim,a=layui.layer,n=(t.callback("contentParser",e=>{e=$("<div>").html(e),e=$("<div>").text(e.html()).html(),e=converter.makeHtml(e),e=$(`<div><div class="markdown-body">${e}</div></div>`);return e.find("pre code").each(function(e,t){console.log(t),$(t).parents("pre").attr("style","padding:1em !important;"),Prism.highlightElement(t);t=$(t);t.replaceWith("<div>"+t.html()+"</div>")}),e.html()}),t.config(layImConfig),t.extendChatTools(chatTools),t.on("sign",async function(e){try{var t=new FormData;t.append("sign",e);var o=await(await fetch("/Account/UpdateSign",{method:"POST",body:t})).json();o.success||a.msg(o.msg)}catch(e){console.error(e)}}),await getSignalRConnection("/chatHub")),i=await getSignalRConnection("/robotChat");n.on("ReceiveMessage",function(e){e.timestamp=1e3*e.timestamp,t.getMessage(e)}),i.on("Answer",function(e){console.log(e),t.getMessage(e)}),i.on("SystemError",function(e){console.error(e),t.getMessage(e)}),n.on("System",function(e){e.code<0?(outPutError(e.content),n.stop()):0!==e.code||e.isGuest?1===e.code&&(a.msg(e.user.name+"上线了"),t.setFriendStatus(e.user.id,"online")):(a.msg(e.user.name+"下线了"),t.setFriendStatus(e.user.id,"offline"))}),t.on("sendMessage",async function(e){var t=e.receiver.id,o=e.receiver.type,e=e.user.content;try{"kefu"===t&&await i.invoke("SendMessage",e),"e0a82f97-d01d-43c0-a257-97998003e8b9"===t?await i.invoke("SendMessageToChatGpt",e):"friend"===o?await n.invoke("SendMessageToUser",t,e):"group"===o&&await n.invoke("SendMessageToGroup",t,e)}catch(e){console.error(e)}}),t.on("viewMmembers",loadMembers),t.callback("chatlog",async function(e){console.log(e);e=await fetch(`/Chat/ChatRecord/${e.receiver.id}?type=`+e.receiver.type);return e.json()})}}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){addShakeAnimation(),initMobileSearch()}):(addShakeAnimation(),initMobileSearch()),window.addEventListener("resize",function(){clearTimeout(window.mobileSearchResizeTimer),window.mobileSearchResizeTimer=setTimeout(function(){window.innerWidth<=768&&initMobileSearch()},250)}),$(document).delegate(".category-toggle","click",function(e){var t=$(this),o=t.closest(".achievement-category-section"),a=o.find(".category-content"),n=t.find(".toggle-icon"),o=o.attr("data-category");a.hasClass("collapsed")?(a.removeClass("collapsed"),t.removeClass("collapsed"),n.removeClass("layui-icon-right").addClass("layui-icon-down"),localStorage.setItem("steam-achievements-"+o,"expanded")):(a.addClass("collapsed"),t.addClass("collapsed"),n.removeClass("layui-icon-down").addClass("layui-icon-right"),localStorage.setItem("steam-achievements-"+o,"collapsed"))});
//# sourceMappingURL=site.min.js.map