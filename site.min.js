function loadImages(t){var n=[];for(let e=0;e<t.length;e++){let o=t[e];var a=new Promise((e,t)=>{o.complete?e(o):(o.addEventListener("load",function(){(o.complete?e:t)(o)}),o.addEventListener("error",function(){console.warn(`the image [${o.src}] loaded error.`),t(o)}))});n.push(a)}return Promise.all(n)}function lightCode(){document.querySelectorAll("pre code").forEach(e=>{Prism.highlightElement(e)}),codeBlockTools()}function processBlockTools(o){if(0!==o.length&&!o.parent().hasClass("code-area")){o.wrap('<div class="code-area" style="position: relative"></div>');let e=o.parent();var t=$('<i class="fa fa-angle-up fa-fw code-expand" aria-hidden="true" title="折叠"></i>'),t=(e.prepend(t),t.on("click",function(){e.hasClass("code-closed")?(o.find("code").show(),o.find(".line-highlight").show(),$(this).parent().removeClass("code-closed")):(o.find("code").hide(),o.find(".line-highlight").hide(),e.addClass("code-closed"))}),$('<i class="fa fa-copy fa-fw code_copy" title="复制代码" aria-hidden="true"></i>')),n=$('<div class="codecopy_notice"></div>'),n=(e.prepend(t),e.prepend(n),t.on("click",function(){var e=window.getSelection(),t=document.createRange(),t=(t.selectNodeContents(o.find("code")[0]),e.removeAllRanges(),e.addRange(t),e.toString());copy(t,this),e.removeAllRanges()}),$('<div class="code_lang" title="代码语言"></div>'));o.before(n),o.each(function(){var e;for(e of $(this).prop("class").split(/\s+/))if(e.startsWith("language")){var t=e.replace("language-","").trim();$(this).siblings(".code_lang").text(t);break}})}}function codeBlockTools(){var e;for(e of $("pre[class*=language-]"))processBlockTools($(e))}function copy(e,t){if(document.queryCommandSupported&&document.queryCommandSupported("copy"))try{document.execCommand("copy"),layer.msg("复制成功")}catch(e){return layer.msg("复制失败"),!1}else layer.msg("浏览器不支持")}function outPutSuccess(e){console.log(`%c Success %c [${moment().format("YYYY-MM-DD HH:mm:ss")}]  %c `+e,"color: #bb0662; background: #030307; padding:5px 0;","color: #fadfa3; background: #393d49; padding:5px 0","font-weight:bold; color: black; background: #77f2e1; padding:5px 0;")}function outPutInfo(e){console.log(`%c Info %c [${moment().format("YYYY-MM-DD HH:mm:ss")}]  %c `+e,"color: #bb0662; background: #030307; padding:5px 0;","color: #fadfa3; background: #393d49; padding:5px 0","font-weight:bold; color: black; background: #fadfa3; padding:5px 0;")}function outPutError(e){console.log(`%c Error %c [${moment().format("YYYY-MM-DD HH:mm:ss")}]  %c `+e,"color: #bb0662; background: #030307; padding:5px 0;","color: #fadfa3; background: #393d49; padding:5px 0","font-weight:bold; color: black; background: red; padding:5px 0;")}function ajaxFail(e,t,o){console.log(e),console.log(t),console.log(o),e.hasOwnProperty("responseJSON")&&e.responseJSON.hasOwnProperty("success")&&e.responseJSON.hasOwnProperty("msg")&&!1===e.responseJSON.success?layer.alert(e.responseJSON.msg):layer.msg("error:"+e.status)}(async()=>{var e;moment.locale("zh-cn"),new LazyLoad({}),"granted"!==Notification.permission&&(e=await Notification.requestPermission(function(e){"granted"===e&&console.info("通知已授权")}),console.log(e))})(),$.fn.relativeTime=function(){this.each(function(e){var t,o;void 0===$(this).data("timeStatus")&&(o=$(this).attr("datetime"),t=$(this).text(),o=moment(o,"YYYY/MM/DD HH:mm:ss").fromNow(),$(this).text(o).attr("title",t).data("timeStatus","loaded"))})};let videoItems=[];async function initVideoPlayer(){var e,t=document.getElementById("video-player")||document.getElementById("m-video-player"),t=(null!==t&&(0===videoItems.length&&(e=await fetch(dpzOption.webApiBaseAddress+"/api/Video",{method:"GET",headers:{"Content-Type":"application/json"},mode:"cors"}),videoItems=await e.json()),t.style.marginBottom="1em",window.innerWidth<=550&&(t.style.marginBottom="4em"),t.style.aspectRatio="16/9",e=Math.floor(Math.random()*videoItems.length),videoPlayer(t,videoItems[e].m3u8,videoItems[e].id)),document.querySelector("[data-watch-video]"));null!==t&&(e=JSON.parse(t.dataset.watchVideo),t.style.marginBottom="1em",t.style.aspectRatio="16/9",videoPlayer(t,e.url,e.id))}function videoPlayer(e,t,o){new Artplayer({container:e,url:t,type:"m3u8",fullscreenWeb:!0,fullscreen:!0,customType:{m3u8:function(t,o,n){if(Hls.isSupported()){n.hls&&n.hls.destroy();let e=new Hls;e.loadSource(o),e.attachMedia(t),n.hls=e,n.on("destroy",()=>e.destroy())}else t.canPlayType("application/vnd.apple.mpegurl")?t.src=o:n.notice.show="Unsupported playback format: m3u8"}},plugins:[artplayerPluginDanmuku({danmuku:async function(){return(await fetch("/history/danmaku/v2/"+o)).json()}})],controls:[]}).on("artplayerPluginDanmuku:emit",async e=>{e.id=o,await fetch("/send/danmaku/v2",{method:"post",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)})})}async function initFetchContent(){var e,t;for(e of document.querySelectorAll("[data-request]"))"loaded"!==e.dataset.status&&(t=await fetch(e.dataset.request,{method:"GET"}),e.dataset.status="loaded",e.innerHTML=await t.text(),$("time.timeago").relativeTime(),lightCode())}function generateToc(){var e=$(".js-toc");0!==e.length&&(0===$(".article-detail-content").find("h1,h2,h3").length?(tocbot.destroy(),$("label.toc-icon.menu").hide(),e.hide()):tocbot.init({tocSelector:".js-toc",contentSelector:".article-detail-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0}))}let dpzOption={webApiBaseAddress:document.querySelector("meta[name=web-api-base-address]").content,CDNBaseAddress:document.querySelector("meta[name=cdn-base-address]").content,isDark:window.matchMedia("(prefers-color-scheme: dark)").matches};function leftIn(){$(".blog-mask").unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend"),$(".blog-nav-left").unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend"),$(".blog-mask").removeClass("maskOut"),$(".blog-mask").addClass("maskIn"),$(".blog-mask").removeClass("layui-hide"),$(".blog-mask").addClass("layui-show"),$(".blog-nav-left").removeClass("leftOut"),$(".blog-nav-left").addClass("leftIn"),$(".blog-nav-left").removeClass("layui-hide"),$(".blog-nav-left").addClass("layui-show")}function leftOut(){$(".blog-mask").on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(".blog-mask").addClass("layui-hide")}),$(".blog-nav-left").on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(".blog-nav-left").addClass("layui-hide")}),$(".blog-mask").removeClass("maskIn"),$(".blog-mask").addClass("maskOut"),$(".blog-mask").removeClass("layui-show"),$(".blog-nav-left").removeClass("leftIn"),$(".blog-nav-left").addClass("leftOut"),$(".blog-nav-left").removeClass("layui-show")}function categoryToggleV2(){var e=$(".right-category-nav-v2");$(".right-category-toggle-v2"),$(".right-category-mask-v2");(e.hasClass("category-visible-v2")?categoryOutV2:categoryInV2)()}function categoryInV2(){let e=$(".right-category-nav-v2");var t=$(".right-category-toggle-v2"),o=$(".right-category-mask-v2");e.unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend"),o.addClass("mask-visible-v2"),e.removeClass("category-hidden-v2 category-slide-out-v2"),e.addClass("category-visible-v2 category-slide-in-v2"),e.show(),t.addClass("toggle-active-v2"),e.on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){e.removeClass("category-slide-in-v2"),e.unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend")})}function categoryOutV2(){let e=$(".right-category-nav-v2");var t=$(".right-category-toggle-v2"),o=$(".right-category-mask-v2");e.hasClass("category-visible-v2")&&(o.removeClass("mask-visible-v2"),e.removeClass("category-slide-in-v2"),e.addClass("category-slide-out-v2"),t.removeClass("toggle-active-v2"),e.on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){e.removeClass("category-visible-v2 category-slide-out-v2"),e.addClass("category-hidden-v2"),e.hide(),e.unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend")}))}function categroyIn(){categoryInV2()}function categoryOut(){categoryOutV2()}function pjaxCompleteInit(){lightCode(),generateToc(),$("time.timeago").relativeTime(),initVideoPlayer().catch(e=>console.log(e)),initFetchContent().catch(e=>console.log(e)),window.innerWidth<=768&&initMobileSearch(),window.initAlbums()}async function showNotify(e){var t,o;return"Notification"in window&&(t=await Notification.requestPermission(),o={title:"",content:"",image:"https://cdn.dpangzi.com/logo.png"},$.extend(o,e),"granted"===t)?new Notification(o.title,{icon:o.image,body:o.content,lang:"zh-cn",tag:o.tag}):null}dpzOption.isDark&&document.querySelector("#layui_theme_css").setAttribute("href",dpzOption.CDNBaseAddress+"/lib/layui/css/layui-theme-dark.css"),(async()=>{try{var e=await(await fetch("/account/GetUserInfo")).json();e.success&&$(".blog-user-v2").attr("href","/account").find("img").attr({src:""+e.data.avatar,title:e.data.name})}catch(e){console.warn("get user info fail. error:"+e)}let i=".article.shadow .article-left img,.mumble-list .mumble-item .mumble-content img,.article-detail-content img,#cd-timeline .content img,.mumble-item img",t=($(document).delegate(i,"click",function(){let e=layer.load(1),a=$(i);loadImages(a).then(t=>{var o=[];for(let e=0;e<t.length;e++){var n=t[e];o.push({src:n.src,w:n.naturalWidth,h:n.naturalHeight,title:n.alt})}var e={index:a.index(this),bgOpacity:.7,showHideOpacity:!0,history:!0,getThumbBoundsFn:function(e){var e=document.querySelectorAll(i)[e],t=window.pageYOffset||document.documentElement.scrollTop,e=e.getBoundingClientRect();return{x:e.left,y:e.top+t,w:e.width}}};new PhotoSwipe(document.getElementById("gallery"),PhotoSwipeUI_Default,o,e).init()}).finally(()=>layer.close(e))}),$(document).delegate("#i-search","submit",function(){var e=$("#i-keyword").val(),t=$(this).find("[name=q]");$(this).find("[name=q]").val(t.data("default")+" "+e)}),$(document).delegate("#i-keyword","keyup",function(e){13===e.keyCode&&$(this).parents("form").submit()}),$(document).delegate("#i-search a.search-btn","click",function(){$(this).parents("form").submit()}),$(document).delegate("[title]:not(.react-jinke-music-player-main *)","touchend",function(){var e=$(this).attr("title");layer.tips(e,this,{tips:3})}),e=await(await fetch("/Music/Recommend/v2")).json(),ReactJkMusicPlayer.defaultProps.quietUpdate=!0,ReactJkMusicPlayer.defaultProps.locale="zh_CN",ReactJkMusicPlayer.defaultProps.defaultPosition={bottom:0,left:0},ReactJkMusicPlayer.defaultProps.preload=!0,ReactJkMusicPlayer.defaultProps.glassBg=!0,ReactJkMusicPlayer.defaultProps.autoPlay=!1,ReactJkMusicPlayer.defaultProps.remove=!1,ReactJkMusicPlayer.defaultProps.showMiniProcessBar=!0,ReactJkMusicPlayer.defaultProps.showDownload=!1,ReactJkMusicPlayer.defaultProps.showLyric=!0,ReactJkMusicPlayer.defaultProps.showMediaSession=!0,ReactJkMusicPlayer.defaultProps.showDestroy=!1,ReactJkMusicPlayer.defaultProps.showReload=!1,ReactJkMusicPlayer.defaultProps.volumeFade={fadeIn:300,fadeOut:300},ReactJkMusicPlayer.defaultProps.sortableOptions={disabled:!0,forceFallback:!0},ReactJkMusicPlayer.defaultProps.audioLists=e,ReactDOM.render(React.createElement(ReactJkMusicPlayer),document.getElementById("music-player")),null);function o(e){clearTimeout(t),t=setTimeout(function(){var e=document.querySelector(".blog-nav-v2");e&&(0<window.scrollY?e.classList.add("scrolled"):e.classList.remove("scrolled"))},100)}function n(){let o=window.location.pathname;var e=window.location.search;let n=o+e;document.querySelectorAll(".blog-nav-item-v2, .blog-nav-dropdown-item-v2, .blog-nav-mobile-item-v2, .blog-nav-mobile-submenu-item-v2").forEach(e=>{e.classList.remove("nav-active-v2")});e=[".blog-nav-item-v2 > a[data-pjax]",".blog-nav-dropdown-item-v2 > a[data-pjax]",".blog-nav-mobile-item-v2 > a[data-pjax]",".blog-nav-mobile-submenu-item-v2 > a[data-pjax]"];let a=!1;e.forEach(e=>{document.querySelectorAll(e).forEach(e=>{var t=e.getAttribute("href");!t||t!==o&&t!==n||(t=e.closest("li"))&&(t.classList.add("nav-active-v2"),a=!0,(e=t.closest(".blog-nav-item-v2"))&&e.classList.add("nav-active-v2"),e=t.closest(".blog-nav-mobile-item-v2.has-submenu"))&&(e.classList.add("nav-active-v2"),e.classList.add("submenu-open"))})}),a||e.forEach(e=>{document.querySelectorAll(e).forEach(e=>{var t=e.getAttribute("href");t&&"/"!==t&&o.startsWith(t)&&(t=e.closest("li"))&&(t.classList.add("nav-active-v2"),(e=t.closest(".blog-nav-item-v2"))&&e.classList.add("nav-active-v2"),e=t.closest(".blog-nav-mobile-item-v2.has-submenu"))&&(e.classList.add("nav-active-v2"),e.classList.add("submenu-open"))})})}$(window).off("scroll",o).on("scroll",o);let c=!1,a=!1,d={toggleClick:null,maskClick:null,submenuToggles:[],menuLinks:[],resize:null,keydown:null};function s(){if(console.log("initMenuV2 called, current status:",c),c)console.log("Menu v2 already initialized, skipping");else{var e=document.getElementById("blog-nav-toggle-v2");let t=document.getElementById("blog-nav-mobile-v2"),o=document.getElementById("blog-nav-mask-v2");function n(e){e.preventDefault(),e.stopPropagation(),t.classList.contains("show")?(t.classList.remove("show"),o.classList.remove("show"),document.body.style.overflow=""):(t.classList.add("show"),o.classList.add("show"),document.body.style.overflow="hidden")}function a(){t.classList.remove("show"),o.classList.remove("show"),document.body.style.overflow=""}function i(e){e.preventDefault(),e.stopPropagation();let t=this.parentElement;e=t.classList.contains("submenu-open");document.querySelectorAll(".blog-nav-mobile-item-v2.has-submenu").forEach(function(e){e!==t&&e.classList.remove("submenu-open")}),e?t.classList.remove("submenu-open"):t.classList.add("submenu-open")}function s(){setTimeout(function(){t&&o&&(t.classList.remove("show"),o.classList.remove("show"),document.body.style.overflow="")},100)}function l(){992<=window.innerWidth&&t&&o&&(t.classList.remove("show"),o.classList.remove("show"),document.body.style.overflow="")}function r(e){"Escape"===e.key&&t&&t.classList.contains("show")&&(t.classList.remove("show"),o.classList.remove("show"),document.body.style.overflow="")}e&&t&&o?(console.log("Initializing menu v2 events..."),d.toggleClick=n,d.maskClick=a,d.resize=l,d.keydown=r,e.addEventListener("click",n),o.addEventListener("click",a),document.querySelectorAll(".blog-nav-mobile-item-v2.has-submenu > a").forEach(function(e){e.addEventListener("click",i),d.submenuToggles.push({element:e,handler:i})}),document.querySelectorAll(".blog-nav-mobile-v2 a[href]:not(.submenu-toggle)").forEach(function(e){e.addEventListener("click",s),d.menuLinks.push({element:e,handler:s})}),window.addEventListener("resize",l),document.addEventListener("keydown",r),c=!0,console.log("Menu v2 initialization completed successfully")):console.warn("Menu v2 elements not found",{navToggle:!!e,navMobile:!!t,navMask:!!o})}}function l(){console.log("cleanupMenuV2 called, current status:",c);var e=document.getElementById("blog-nav-toggle-v2"),t=document.getElementById("blog-nav-mobile-v2"),o=document.getElementById("blog-nav-mask-v2");e&&d.toggleClick&&e.removeEventListener("click",d.toggleClick),o&&d.maskClick&&o.removeEventListener("click",d.maskClick),d.resize&&window.removeEventListener("resize",d.resize),d.keydown&&document.removeEventListener("keydown",d.keydown),d.submenuToggles.forEach(function(e){e.element&&e.handler&&e.element.removeEventListener("click",e.handler)}),d.menuLinks.forEach(function(e){e.element&&e.handler&&e.element.removeEventListener("click",e.handler)}),d={toggleClick:null,maskClick:null,submenuToggles:[],menuLinks:[],resize:null,keydown:null},c=!1,t&&o&&(t.classList.remove("show"),o.classList.remove("show"),document.body.style.overflow=""),console.log("Menu v2 cleanup completed")}function r(){a||(document.querySelectorAll(".blog-nav-item-v2").forEach(function(t){let o=t.querySelector(".blog-nav-dropdown-v2");if(o){let e=null;function n(){clearTimeout(e),o.classList.add("dropdown-visible"),o.style.display="block",o.style.opacity="1",o.style.visibility="visible",o.style.transform="translateY(0)",o.style.pointerEvents="auto"}function a(){e=setTimeout(function(){o.classList.remove("dropdown-visible"),o.style.display="none",o.style.opacity="0",o.style.visibility="hidden",o.style.transform="translateY(-10px)",o.style.pointerEvents="none"},150)}function i(){clearTimeout(e),o.classList.add("dropdown-visible"),o.style.display="block",o.style.opacity="1",o.style.visibility="visible",o.style.transform="translateY(0)",o.style.pointerEvents="auto"}function s(){e=setTimeout(function(){o.classList.remove("dropdown-visible"),o.style.display="none",o.style.opacity="0",o.style.visibility="hidden",o.style.transform="translateY(-10px)",o.style.pointerEvents="none"},150)}t.addEventListener("mouseenter",n),t.addEventListener("mouseleave",a),o.addEventListener("mouseenter",i),o.addEventListener("mouseleave",s),t._dropdownHandlers={itemEnter:n,itemLeave:a,dropdownEnter:i,dropdownLeave:s}}}),a=!0)}function u(){document.querySelectorAll(".blog-nav-item-v2").forEach(function(e){var t=e.querySelector(".blog-nav-dropdown-v2");t&&e._dropdownHandlers&&(e.removeEventListener("mouseenter",e._dropdownHandlers.itemEnter),e.removeEventListener("mouseleave",e._dropdownHandlers.itemLeave),t.removeEventListener("mouseenter",e._dropdownHandlers.dropdownEnter),t.removeEventListener("mouseleave",e._dropdownHandlers.dropdownLeave),delete e._dropdownHandlers)}),a=!1}s(),r(),n(),window.initMenuV2=s,window.cleanupMenuV2=l,window.initDesktopDropdowns=r,window.cleanupDesktopDropdowns=u,window.updateMenuActiveState=n,$(document).on("pjax:complete",function(){console.log("pjax:complete event triggered"),setTimeout(function(){console.log("Starting menu reinitialization after pjax..."),u(),l(),s(),r(),n(),console.log("Menu reinitialization completed after pjax")},100)}),window.addEventListener("popstate",function(){setTimeout(n,100)})})(),layui.use(["element","layer","carousel","util","flow","form","upload"],function(){let t=layui.layer,e=layui.flow,o=layui.util;if(o.fixbar({bar1:"&#xe64a;",css:{bottom:55},click:function(e){if("bar1"===e){let e=t.load(),n=(console.log(event),event.target||event.srcElement);$.ajax({url:"/Home/TodayWallpaper"}).done(function(e){var t,o=[];for(t of e)o.push({src:t.url.replaceAll("1920x1080","UHD"),w:1920,h:1080,title:t.copyRight});e={index:0,bgOpacity:.7,showHideOpacity:!0,history:!0,getThumbBoundsFn:function(e){var t=window.pageYOffset||document.documentElement.scrollTop,o=n.getBoundingClientRect()||{left:0,top:0,width:0};return{x:o.left,y:o.top+t,w:o.width}}};new PhotoSwipe(document.getElementById("gallery"),PhotoSwipeUI_Default,o,e).init()}).always(function(){t.close(e)})}}}),e.lazyimg(),640<=$(window).width())try{let t=document.querySelector("#can-back-round");var n=t.getBoundingClientRect();t.width=n.width,t.height=n.height;let o=new RaindropFX({canvas:t,background:dpzOption.isDark?"https://cdn.dpangzi.com/wallpaper.jpg":dpzOption.CDNBaseAddress+"/../images/background.jpg"});window.onresize=()=>{var e=t.getBoundingClientRect();o.resize(e.width,e.height)},o.start()}catch(e){console.log(e)}}),$(document).delegate(".blog-navicon","click",function(){(new RegExp("layui-hide").test($(".blog-nav-left").attr("class"))?leftIn:leftOut)()}),$(document).delegate(".blog-mask","click",function(){leftOut()}),$(document).delegate(".right-category-toggle-v2","click",function(){categoryToggleV2()}),$(document).delegate(".right-category-mask-v2","click",function(){categoryOutV2()}),$(document).delegate(".right-category-tag-v2","click",function(){$(".right-category-tag-v2").removeClass("right-category-tag-active-v2"),$(this).addClass("right-category-tag-active-v2")}),$(window).resize(function(){768<$(window).width()&&categoryOutV2()}),layui.use(["element"],function(){let o=layui.element,n=layui.form,a=void($.pjax.defaults.timeout=2e4,$(document).pjax("nav.blog-nav ul.layui-nav>li>a,a[data-pjax]",".blog-body"),$(document).pjax("#blog-list a",".blog-main-left"),$(document).pjax("#articl-comment a","#blog-comment",{scrollTo:!1}),$(document).pjax("#talk-pager a",".mumble-list"),$(document).pjax(".right-category-tags-v2 a.right-category-tag-v2,.bookmark .category-box .category",".blog-body"),$(document).pjax(".code-box .box-rows .row .header a",".code-box .box-rows"),$.support.pjax&&$(".tags a").on("click",function(e){$(".tags a").removeClass("tag-this"),$(this).addClass("tag-this");$.pjax.click(e,{container:".blog-main-left"})}),pjaxCompleteInit(),$(document).on("pjax:send",function(){NProgress.start(),window.cleanupAlbums()})),e=($(document).on("pjax:complete",function(e,t){""===(a=t.getResponseHeader("title"))||null===a?document.title="（；´д｀）ゞ标题不见啦 - 叫我阿胖":document.title=Base64.decode(a),o.render(),n.render(),categoryOut(),leftOut(),pjaxCompleteInit(),NProgress.done()}),new LazyLoad({}));$(document).on("pjax:end",function(){e.update()})}),(async()=>{let e=(new signalR.HubConnectionBuilder).withUrl("/notification",{skipNegotiation:!0,transport:signalR.HttpTransportType.WebSockets}).withAutomaticReconnect().build();try{await e.start(),await e.invoke("Init")}catch(e){console.error(e)}e.on("pushMessage",async function(e){var t=await showNotify({title:"小喇叭开始广播辣",content:e.markdown});null!==t&&(t.onclick=function(){window.open("/talk.html")}),console.info(e)}),e.on("pushLogMessage",function(e,t){0===e?(outPutSuccess(t),$.notify(moment().format("YYYY-MM-DD HH:mm:ss")+`
`+t,"success")):1===e?(outPutInfo(t),$.notify(moment().format("YYYY-MM-DD HH:mm:ss")+`
`+t,"warn")):2===e&&(outPutError(t),$.notify(moment().format("YYYY-MM-DD HH:mm:ss")+`
`+t,"error"))});let a=null;function o(){e.invoke("getRunTime")}e.on("cnBetaSubscribe",function(t){var o=[];if(t.hasOwnProperty("progressValues")&&Array.isArray(t.progressValues))for(let e=0;e<t.progressValues.length;e++){var n=(100*t.progressValues[e]).toFixed(2);o.push(parseFloat(n))}switch(null==a?a=notification.show({title:"CnBeta发布",content:t.message,bars:o}):(notification.setContent(a,t.message),notification.setProgress(a,o)),t.type){case 0:outPutSuccess(t.message);break;case 1:outPutInfo(t.message);break;case 2:outPutError(t.message);break;case 3:outPutSuccess(t.message),setTimeout(function(){notification.close(a),a=null},1e3)}}),e.on("ready",function(e){console.info(e)}),setTimeout(function(){o()},1e3),e.on("ReceiveRunTime",function(e){var t=$("#runTime");0<t.length&&(t.text("运行时间 "+e),setTimeout(o,1e3))}),e.on("systemNotification",function(e){layer.msg(e)})})(),(async()=>{var e=(new signalR.HubConnectionBuilder).withUrl("/app/notification",{skipNegotiation:!0,transport:signalR.HttpTransportType.WebSockets}).withAutomaticReconnect().build();try{await e.start()}catch(e){console.error(e)}e.on("systemMessage",function(e,t){0===e?(outPutSuccess(t),$.notify(t,"success")):1===e?(outPutInfo(t),$.notify(t,"warn")):2===e&&(outPutError(t),$.notify(t,"error"))})})();let notification={_instances:new Set,show:function(e){var e={title:"",content:"",bars:[],autoClose:0,type:"info",...e=e&&"object"==typeof e?e:{}},t=this._calculateTopPosition();let o=this._createBox(e);return o.css("top",t+"px"),$("body").append(o),this._instances.add(o[0]),0<e.autoClose&&setTimeout(()=>this.close(o),e.autoClose),requestAnimationFrame(()=>{o.addClass("notification-enter")}),o},setContent:function(e,t){this._validateBox(e)&&0<(e=e.find(".content")).length&&e.text(String(t||""))},setTitle:function(e,t){this._validateBox(e)&&0<(e=e.find(".title")).length&&e.text(String(t||""))},setProgress:function(e,t){if(this._validateBox(e)&&Array.isArray(t)){let o=e.find(".content-container .progress .bar");t.forEach((e,t)=>{"number"==typeof e&&t<o.length&&(e=Math.max(0,Math.min(100,e)),o.eq(t).css("width",e+"%").text(e.toFixed(1)+"%"))})}},close:function(e){this._validateBox(e)&&(e.addClass("notification-exit"),setTimeout(()=>{e[0]&&(this._instances.delete(e[0]),e.remove(),this._recalculatePositions())},300))},closeAll:function(){Array.from(this._instances).forEach(e=>{e=$(e);0<e.length&&this.close(e)})},getActiveCount:function(){return this._instances.size},test:function(){let e=this.show({title:"测试通知",content:"正在加载...",bars:[0],type:"info"}),t=0,o=setInterval(()=>{100<=t?(this.setContent(e,"加载完毕，即将关闭！"),clearInterval(o),setTimeout(()=>this.close(e),1e3)):(t+=2,this.setContent(e,`进度: ${t}%`),this.setProgress(e,[t]))},50)},_validateBox:function(e){return e&&0<e.length&&this._instances.has(e[0])},_calculateTopPosition:function(){let t=15;return this._instances.forEach(e=>{e=$(e);e.is(":visible")&&(t+=e.outerHeight(!0)+15)}),t},_recalculatePositions:function(){let t=15;this._instances.forEach(e=>{e=$(e);e.is(":visible")&&(e.css("top",t+"px"),t+=e.outerHeight(!0)+15)})},_createBox:function(e){var t=$("<div>").addClass("notification-box notification-"+e.type),o=(e.title&&(o=$("<div>").addClass("title").text(e.title),t.append(o)),$("<div>").addClass("content-container")),n=$("<div>").addClass("content").text(e.content);return o.append(n),this._createProgressBars(o,e.bars),t.append(o),this._addCloseButton(t),t},_createProgressBars:function(o,e){Array.isArray(e)&&0!==e.length&&e.forEach(e=>{var t;"number"==typeof e&&(e=Math.max(0,Math.min(100,e)),t=$("<div>").addClass("progress"),e=$("<div>").addClass("bar").css("width",e+"%").text(e.toFixed(1)+"%"),t.append(e),o.append(t))})},_addCloseButton:function(t){var e=$("<button>").addClass("notification-close").html("&times;").attr("aria-label","关闭通知").on("click",e=>{e.preventDefault(),e.stopPropagation(),this.close(t)});t.append(e)}},layImConfig=((()=>{function e(){$(".bookmark-item .bookmark-card").each(function(){var e=$(this),t=e.children("img").filter(":not(.bookmark-icon)"),o=e.find("img[data-src]:not(.bookmark-icon)");0<t.length||0<o.length?e.removeClass("no-image"):e.addClass("no-image")})}$(document).ready(function(){e()}),$(document).on("pjax:complete",function(){setTimeout(e,100)}),$(document).on("load",".bookmark-card img:not(.bookmark-icon)",function(){e()}),$(document).on("lazyloaded",".bookmark-card img:not(.bookmark-icon)",function(){e()});let a="";$(document).delegate(".bookmark .search-box input[type=search]","input",function(){a=$(this).val();let e=[];$(".bookmark .category-box .category.active").each(function(){e.push($(this).text())}),$.ajax({type:"get",url:"/bookmark/search",traditional:!0,data:{title:a,categories:e}}).done(function(e){if(e.success){$(".bookmark .search-box .search-result").show();var t,o=[];for(t of e.data)o.push(`<li>${t}</li>`);$(".bookmark .search-box .search-result ul").html(o.join(""))}})}),$(document).delegate(".bookmark .search-box input[type=search]","keyup",function(t){if(13===t.keyCode){t=$(this).val();let e=[];$(".bookmark .category-box .category.active").each(function(){e.push("categories="+encodeURIComponent($(this).text()))}),""===t.trim()&&0===e.length?$.pjax({url:"/bookmark.html",container:".blog-body"}):""===t.trim()&&0!==e.length?$.pjax({url:"/bookmark.html?"+e.join("&"),container:".blog-body"}):""!==t.trim()&&0===e.length?$.pjax({url:"/bookmark.html?title="+encodeURIComponent(t),container:".blog-body"}):$.pjax({url:`/bookmark.html?title=${encodeURIComponent(t)}&`+e.join("&"),container:".blog-body"})}}),$(document).delegate(".bookmark .search-box .search-result ul li","click",function(){var e=$(this).text();let t=[];$(".bookmark .category-box .category.active").each(function(){t.push("categories="+encodeURIComponent($(this).text()))}),0===t.length?$.pjax({url:"/bookmark.html?title="+encodeURIComponent(e),container:".blog-body"}):$.pjax({url:`/bookmark.html?title=${encodeURIComponent(e)}&`+t.join("&"),container:".blog-body"})}),$(document).delegate(".bookmark .search-box input[type=search]","blur",function(){setTimeout(function(){$(".bookmark .search-box .search-result").hide()},300)}),$(document).delegate(".bookmark .search-box input[type=search]","focus ",function(){0<$(".bookmark .search-box .search-result ul li").length&&$(".bookmark .search-box .search-result").show()}),$(document).delegate(".bookmark .search-box input[type=search]","keydown",function(e){var t,o=$(".bookmark .search-box .search-result ul li"),n=$(".bookmark .search-box .search-result ul li.selected");40===e.keyCode?(e.preventDefault(),0===n.length?((t=o.first()).addClass("selected"),$(this).val(t.text())):$(".bookmark .search-box .search-result ul li:last").hasClass("selected")?(o.removeClass("selected"),$(this).val(a)):(t=n.next(),o.removeClass("selected"),0<t.length&&(t.addClass("selected"),$(this).val(t.text())))):38===e.keyCode&&(e.preventDefault(),0===n.length?((t=o.last()).addClass("selected"),$(this).val(t.text())):$(".bookmark .search-box .search-result ul li:first").hasClass("selected")?(o.removeClass("selected"),$(this).val(a)):(e=n.prev(),o.removeClass("selected"),0<e.length&&(e.addClass("selected"),$(this).val(e.text()))))}),$(document).delegate(".bookmark .category-box .category","click",function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active")}),$(document).delegate("form.bookmark-create","submit",function(){var e=new FormData(this);let n=$(this);return $(this).find("button[lay-submit]").addClass("layui-btn-disabled").attr("disabled","disabled").html('<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop layui-font-12"></i> 正在提交'),$.ajax({url:n.attr("action"),processData:!1,contentType:!1,data:e,type:"post"}).done(function(e,t,o){e.success?(n[0].reset(),layer.closeAll(),$.pjax({url:"/bookmark.html",container:".blog-body"})):layer.alert(e.msg)}).fail(ajaxFail),!1}),layui.use(["element","layer","carousel","util","flow","form","upload"],function(){let n=layui.form;$(document).delegate(".bookmark-setting[data-id]","click",function(){var e=$(this).data("id");let t=layer.load(),o=600<$(window).width()?"600px":"100%";$.ajax({url:"/bookmark/update/"+e,type:"get"}).done(function(e){"object"==typeof e?e.success||layer.msg(e.msg):layer.open({type:1,content:e,area:o,success:function(){n.render()}})}).always(function(){layer.close(t)}).fail(ajaxFail)})}),$(document).delegate("form.bookmark-create button[data-delete]","click",function(){let e=layer.load();$.ajax({url:"/bookmark/delete",type:"post",data:{id:$(this).data("delete")}}).done(function(){layer.closeAll(),$.pjax({url:"/bookmark.html",container:".blog-body"})}).always(function(){layer.close(e)})})})(),(()=>{var e;function c(e,t){var o={loading:{class:"ds-button-loading",disabled:!0,html:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12a9 9 0 11-6.219-8.56"></path>
                </svg> 发送中...`},normal:{class:"",disabled:!1,html:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                </svg> 发送`},error:{class:"ds-button-error",disabled:!1,html:`<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg> 重试`}},t=o[t]||o.normal;e.removeClass("ds-button-loading ds-button-error"),t.class&&e.addClass(t.class),t.disabled?e.attr("disabled","disabled"):e.removeAttr("disabled"),e.html(t.html)}document.getElementById("comment-loading-styles")||((e=document.createElement("style")).id="comment-loading-styles",e.textContent=`
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
            
            .ds-button-loading {
                position: relative;
                pointer-events: none;
                opacity: 0.8;
            }
            
            .ds-button-loading svg {
                animation: spin 1s linear infinite;
            }
            
            .ds-button-error {
                background-color: #ef4444;
                border-color: #dc2626;
                color: white;
            }
            
            .ds-button-error:hover {
                background-color: #dc2626;
                border-color: #b91c1c;
            }
        `,document.head.appendChild(e)),$(document).delegate(".comments-area .load-more .ds-button","click",function(){let n=$(this).parents(".comments-area"),a=$(this).parent(),i=$(this).parents().find(".comment-count span");var e=$(this).parent().data("loadingIco"),e=(a.html(`<img src="${e}" class="comment-loading" alt="loading"/>`),parseInt($(this).data("pageIndex"))),t=parseInt($(this).data("pageSize")),o=$(this).data("pageRequest");$(this);$.ajax({url:o,type:"get",data:{pageIndex:e+1,pageSize:t}}).done(function(e,t,o){n.append(e),a.remove(),i.text(o.getResponseHeader("commentCount")),$("time.timeago").relativeTime(),lightCode()}).fail(function(){layer.msg("加载更多评论失败",{icon:2,anim:6}),"function"==typeof ajaxFail&&ajaxFail.apply(this,arguments)})}),$(document).delegate("form.comment-form :input:not(textarea)","keydown",function(e){return"Enter"!==e.key}),$(document).delegate("form.comment-form","submit",function(){event.preventDefault();var e=new FormData(this);let s=$(this),l=$(this).parents(".comment-block").find(".comment-count span"),r=$(this).find("button.ds-button");c(r,"loading"),$.ajax({url:s.attr("action"),processData:!1,contentType:!1,data:e,type:"post"}).done(function(e,t,o){var n,a,i;e.hasOwnProperty("success")&&!1===e.success?(layer.msg(e.msg,{icon:2,anim:6}),c(r,"error"),setTimeout(()=>{c(r,"normal")},3e3)):(a=(n=s.parents(".comment-block")).find(".comments-area:first"),(i=s.clone()).find("textarea").val(""),c(i.find("button.ds-button"),"normal"),i.find("input[name=replyId]").val(""),i.find(".comment-btn-close").hide(),i.find(".comment-btn-close").off("click"),n.find(".comments-area").html(e),s.remove(),a.before(i),l.text(o.getResponseHeader("commentCount")),$("time.timeago").relativeTime(),lightCode())}).fail(function(){c(r,"error"),layer.msg("提交失败，请检查网络连接",{icon:2,anim:6}),setTimeout(()=>{c(r,"normal")},3e3)}).always(function(){r.hasClass("ds-button-error")||r.hasClass("ds-button-loading")||c(r,"normal")})}),$(document).delegate(".comment-count button.refresh","click",function(){let n=$(this).parents(".comment-block").find(".comments-area");var e=$(this).data("refresh")+"?t="+(new Date).getTime();let a=$(this).parent().find("span");var t=n.find("form.comment-form");let i=null,s=!1,o=(0<t.length&&(i=t.clone(),s=!0,i.find("input[name=replyId]").val(""),i.find(".comment-btn-close").hide(),c(i.find("button.ds-button"),"normal")),layer.load());$.ajax({url:e,type:"get"}).done(function(e,t,o){n.html(e),a.text(o.getResponseHeader("commentCount")),s&&i&&n.before(i),$("time.timeago").relativeTime(),lightCode()}).fail(function(){layer.msg("刷新评论失败",{icon:2,anim:6}),s&&i&&n.before(i),"function"==typeof ajaxFail&&ajaxFail.apply(this,arguments)}).always(function(){layer.close(o)})}),$(document).delegate(".footer-action-item[data-image]","click",function(){let n=$(this).parents().find("textarea.comment-form-editor");layer.prompt({title:"请输入网络图片地址"},function(e,t){let o;try{o=new URL(e)}catch{return void layer.msg("请输入正确的地址嗷~")}"https:"!==o.protocol?layer.msg("使用https协议的网络图片嗷~"):(e=`![](${o.toString()})`,n.val(n.val()+"\r\n"+e),layer.close(t))})}),$(document).delegate(".comments-area .comment-item button.btn-reply","click",function(){var e=$(this).parents(".comment-block");let t=$(this).parents(".comments-area");var o=$(this),n=$(this).data("replyId"),e=e.find("form.comment-form");let a;0===e.length?layer.msg("评论表单未找到，请刷新页面重试",{icon:2,anim:6}):(0<t.find("form.comment-form").length?a=t.find("form.comment-form").first():(c((a=e.clone()).find("button.ds-button"),"normal"),e.remove()),a.find("input[name=replyId]").val(n),a.find(".comment-btn-close").show(),a.find(".comment-btn-close").off("click").on("click",function(){a.find("input[name=replyId]").val(""),a.find("textarea").val(""),c(a.find("button.ds-button"),"normal"),t.before(a),$(this).hide()}),o.parents(".comment-block .comment-item:first").find(".detail > .comment-content:first").after(a))}),$(document).ready(function(){$(".comment-block").each(function(){0===$(this).find("form.comment-form").length&&console.warn("Comment form missing, this should not happen in normal operation")})}),console.log("Comment system v2.0 initialized with Design System styles")})(),$(document).delegate("[data-likeid]","click",function(){let t=$(this),e=layer.load(1);$.ajax({url:"/Talk/Like",data:{id:t.data("likeid")},type:"post"}).done(function(e){e.success?t.find("[data-number]").text(e.data):layer.msg(e.msg,{icon:2,anim:6})}).always(function(){layer.close(e)})}),$(document).delegate(".mumble-more a","click",function(){var e=$(this).parents(".mumble-more"),t=$(this).parents(".mumble-item").find(".mumble-content");e.hasClass("mumble-pack-up")?(e.removeClass("mumble-pack-up"),t.addClass("mumble-hide-sub"),$(this).html('查看更多<i class="layui-icon layui-icon-down">')):(e.addClass("mumble-pack-up"),t.removeClass("mumble-hide-sub"),$(this).html('收起<i class="layui-icon layui-icon-up">'))}),$(document).delegate("[data-comment-id]","click",function(){let n=$(this),a=n.parents("div.mumble-item").find("div.mumble-comment[data-talk-id]");if(a.hide("fast",function(){$(this).html("")}),n.parent().hasClass("mumble-active"))n.parent().removeClass("mumble-active");else{n.parent().addClass("mumble-active");let e=layer.load(1);$.ajax({url:"/Comment/Mumble/"+n.data("commentId"),type:"get"}).done(function(e,t,o){n.find("[data-comment-count]").text(o.getResponseHeader("commentCount")),a.html(e),lightCode(),a.show(),n.parents(".comment-parent").find("time.timeago").relativeTime()}).always(function(){layer.close(e)})}}),{contactsPanel:{showFriend:!0,showGroup:!0,minStatus:!0},pageurl:{chatlog:"/chat/record"},init:{url:"/chat/init"},theme:dpzOption.isDark?"dark":"light"}),chatTools=[{name:"code",title:"插入代码",icon:"layui-icon-fonts-code",onClick:function(o){layer.prompt({title:"插入代码",formType:2},function(e,t){layer.close(t),e=["```",e,"```"].join("\n"),o.insert(e)})}}],converter=new showdown.Converter({openLinksInNewWindow:!0,simplifiedAutoLink:!0,splitAdjacentBlockquotes:!0,strikethrough:!0,tables:!0,tasklists:!0});async function loadMembers(e){var t=await(await fetch("/chat/groupMembers/"+e.receiver.id,{method:"GET"})).json();e.render(t.data)}async function getSignalRConnection(e){e=(new signalR.HubConnectionBuilder).withUrl(e,{skipNegotiation:!0,transport:signalR.HttpTransportType.WebSockets}).withAutomaticReconnect().build();try{await e.start()}catch(e){console.error(e)}return e}function log(...e){console.log("[移动端搜索]",...e)}function initMobileSearch(){768<window.innerWidth?log("当前为桌面端，跳过移动端搜索初始化"):document.querySelector(".blog-main-left,.home-main-left-v2")?(log("当前为移动端，开始初始化移动端搜索功能"),createMobileSearchElements(),bindMobileSearchEvents()):log("未找到 .blog-main-left 或 .home-main-left-v2，跳过移动端搜索初始化")}function createMobileSearchElements(){if(document.querySelector(".mobile-search-trigger"))log("移动端搜索触发器已存在，跳过创建");else{log("开始创建移动端搜索元素...");var t=document.createElement("div"),e=(t.className="mobile-search-trigger",t.innerHTML=`
            <div class="mobile-search-trigger-content">
                <i class="fa fa-search mobile-search-trigger-icon"></i>
                <span class="mobile-search-trigger-text">搜索文章、标签或内容...</span>
                <span class="mobile-search-trigger-shortcut">⌘K</span>
            </div>
        `,t.setAttribute("aria-label","打开搜索"),t.setAttribute("role","button"),t.setAttribute("tabindex","0"),document.createElement("div")),o=(e.className="mobile-search-overlay",document.createElement("div")),n=(o.className="mobile-search-container",o.innerHTML=`
            <button class="mobile-search-close" aria-label="关闭搜索">
                <i class="fa fa-times"></i>
            </button>
            <form class="mobile-search-form" action="/Article/Search" method="get">
                <input type="text" class="mobile-search-input" name="keyword" placeholder="搜索文章、标签、内容..." autocomplete="off">
                <button type="submit" class="mobile-search-btn" aria-label="搜索">
                    <i class="fa fa-search"></i>
                </button>
            </form>
        `,document.querySelector(".blog-main-left,.home-main-left-v2"));if(log("找到 .blog-main-left:",!!n),n){var a=n.querySelector(".article"),i=n.querySelector(".blog-search");log("找到 .blog-search:",!!i),log("找到 .article:",!!a);let e=null;i&&i.parentNode===n&&(i=i.nextElementSibling)&&i.parentNode===n&&log("插入位置：桌面搜索框后的元素",(e=i).tagName),!e&&a&&a.parentNode===n&&(e=a,log("插入位置：第一篇文章前")),e?(n.insertBefore(t,e),log("成功插入移动端搜索触发器")):(n.appendChild(t),log("追加移动端搜索触发器到末尾"))}else{log("未找到 .blog-main-left，使用备用方案");i=document.querySelector(".blog-main");i?(a=i.firstElementChild)?(i.insertBefore(t,a),log("插入到 .blog-main 开头")):(i.appendChild(t),log("追加到 .blog-main")):(document.body.appendChild(t),log("插入到 body"))}document.body.appendChild(e),document.body.appendChild(o),e.style.display="none",e.style.visibility="hidden",o.style.display="none",o.style.visibility="hidden",log("移动端搜索元素创建完成并设置为隐藏状态")}}function bindMobileSearchEvents(){var e=document.querySelector(".mobile-search-trigger");let t=document.querySelector(".mobile-search-overlay"),o=document.querySelector(".mobile-search-container");var n=document.querySelector(".mobile-search-close");let a=document.querySelector(".mobile-search-input"),i=document.querySelector(".mobile-search-form");function s(){t.style.display="block",t.style.visibility="visible",o.style.display="block",o.style.visibility="visible",requestAnimationFrame(()=>{t.classList.add("active"),o.classList.add("active"),setTimeout(()=>{a.focus()},300)}),document.body.style.overflow="hidden",log("搜索框已打开")}function l(){t.classList.remove("active"),o.classList.remove("active"),document.body.style.overflow="",setTimeout(()=>{t.classList.contains("active")||(t.style.display="none",t.style.visibility="hidden",o.style.display="none",o.style.visibility="hidden",a.value="",a.blur())},300),log("搜索框已关闭")}e&&t&&o&&n&&a&&i&&(e.addEventListener("click",s),n.addEventListener("click",l),t.addEventListener("click",l),i.addEventListener("submit",function(e){e.preventDefault(),(e=a.value.trim())?(e=i.action+"?keyword="+encodeURIComponent(e),window.location.href=e):(a.focus(),a.style.animation="shake 0.5s",setTimeout(()=>{a.style.animation=""},500))}),document.addEventListener("keydown",function(e){"Escape"===e.key&&o.classList.contains("active")&&l(),!e.ctrlKey&&!e.metaKey||"k"!==e.key||o.classList.contains("active")||(e.preventDefault(),s())}),o.addEventListener("click",function(e){e.stopPropagation()}),window.addEventListener("resize",function(){var e;768<window.innerWidth?(o.classList.contains("active")&&l(),(e=document.querySelector(".mobile-search-trigger"))&&(e.style.display="none"),log("切换到桌面端，隐藏移动端搜索功能")):((e=document.querySelector(".mobile-search-trigger"))&&(e.style.display="block"),log("切换到移动端，显示移动端搜索功能"))}))}function addShakeAnimation(){var e;document.querySelector("#mobile-search-animations")||((e=document.createElement("style")).id="mobile-search-animations",e.textContent=`
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
                20%, 40%, 60%, 80% { transform: translateX(3px); }
            }
            
            .mobile-search-input {
                will-change: transform;
            }
        `,document.head.appendChild(e))}function initSteamAchievements(){var e=$(".category-toggle");0!==e.length&&e.each(function(){var e=$(this),t=e.closest(".achievement-category-section"),o=t.attr("data-category"),n=localStorage.getItem("steam-achievements-"+o),t=t.find(".category-content"),a=e.find(".toggle-icon");null!==n?"collapsed"===n?(t.addClass("collapsed"),e.addClass("collapsed"),a.removeClass("layui-icon-down").addClass("layui-icon-right")):(t.removeClass("collapsed"),e.removeClass("collapsed"),a.removeClass("layui-icon-right").addClass("layui-icon-down")):"unlocked"===o?(t.removeClass("collapsed"),e.removeClass("collapsed"),a.removeClass("layui-icon-right").addClass("layui-icon-down"),localStorage.setItem("steam-achievements-"+o,"expanded")):(t.addClass("collapsed"),e.addClass("collapsed"),a.removeClass("layui-icon-down").addClass("layui-icon-right"),localStorage.setItem("steam-achievements-"+o,"collapsed"))})}layui.config({layimPath:dpzOption.CDNBaseAddress+"/lib/layim/",layimResPath:dpzOption.CDNBaseAddress+"/lib/layim/res/"}).extend({layim:dpzOption.CDNBaseAddress+"/lib/layim/layim"}).use(["layim","layer"],async function(){if(!0!==layui.device().mobile){let t=layui.layim,n=layui.layer,a=(t.callback("contentParser",e=>{e=$("<div>").html(e),e=$("<div>").text(e.html()).html(),e=converter.makeHtml(e),e=$(`<div><div class="markdown-body">${e}</div></div>`);return e.find("pre code").each(function(e,t){console.log(t),$(t).parents("pre").attr("style","padding:1em !important;"),Prism.highlightElement(t);t=$(t);t.replaceWith("<div>"+t.html()+"</div>")}),e.html()}),t.config(layImConfig),t.extendChatTools(chatTools),t.on("sign",async function(e){try{var t=new FormData;t.append("sign",e);var o=await(await fetch("/Account/UpdateSign",{method:"POST",body:t})).json();o.success||n.msg(o.msg)}catch(e){console.error(e)}}),await getSignalRConnection("/chatHub")),i=await getSignalRConnection("/robotChat");a.on("ReceiveMessage",function(e){e.timestamp=1e3*e.timestamp,t.getMessage(e)}),i.on("Answer",function(e){console.log(e),t.getMessage(e)}),i.on("SystemError",function(e){console.error(e),t.getMessage(e)}),a.on("System",function(e){e.code<0?(outPutError(e.content),a.stop()):0!==e.code||e.isGuest?1===e.code&&(n.msg(e.user.name+"上线了"),t.setFriendStatus(e.user.id,"online")):(n.msg(e.user.name+"下线了"),t.setFriendStatus(e.user.id,"offline"))}),t.on("sendMessage",async function(e){var t=e.receiver.id,o=e.receiver.type,e=e.user.content;try{"kefu"===t&&await i.invoke("SendMessage",e),"e0a82f97-d01d-43c0-a257-97998003e8b9"===t?await i.invoke("SendMessageToChatGpt",e):"friend"===o?await a.invoke("SendMessageToUser",t,e):"group"===o&&await a.invoke("SendMessageToGroup",t,e)}catch(e){console.error(e)}}),t.on("viewMmembers",loadMembers),t.callback("chatlog",async function(e){console.log(e);e=await fetch(`/Chat/ChatRecord/${e.receiver.id}?type=`+e.receiver.type);return e.json()})}}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){addShakeAnimation(),initMobileSearch()}):(addShakeAnimation(),initMobileSearch()),window.addEventListener("resize",function(){clearTimeout(window.mobileSearchResizeTimer),window.mobileSearchResizeTimer=setTimeout(function(){window.innerWidth<=768&&initMobileSearch()},250)}),$(document).delegate(".category-toggle","click",function(e){var t=$(this),o=t.closest(".achievement-category-section"),n=o.find(".category-content"),a=t.find(".toggle-icon"),o=o.attr("data-category");n.hasClass("collapsed")?(n.removeClass("collapsed"),t.removeClass("collapsed"),a.removeClass("layui-icon-right").addClass("layui-icon-down"),localStorage.setItem("steam-achievements-"+o,"expanded")):(n.addClass("collapsed"),t.addClass("collapsed"),a.removeClass("layui-icon-down").addClass("layui-icon-right"),localStorage.setItem("steam-achievements-"+o,"collapsed"))}),(()=>{let u=!1,m=!0,g=null,p=null,a=null,h=null,i={click:null,load:null,error:null,resize:null,scroll:null},f={currentPage:1,pageSize:20,totalPages:1,totalCount:0,hasNextPage:!1,pictures:[]},y={loadThreshold:200,loadDelay:500,animationDelay:100,maxRetries:3,retryDelay:1e3,preloadCount:3};function e(){try{if("undefined"==typeof $)console.error("jQuery is required for albums page");else if(f&&f.pictures){if(p=document.getElementById("albumsLoading"),a=document.getElementById("albumsNoMore"),!(h=document.getElementById("albumsMasonry")))throw new Error("Masonry container not found");var e=document.querySelector(".albums-container-v2"),t=document.querySelector("#albums-pictures-data");if(e&&t){f.currentPage=parseInt(e.dataset.currentPage)||1,f.pageSize=parseInt(e.dataset.pageSize)||20,f.totalPages=parseInt(e.dataset.totalPages)||1,f.totalCount=parseInt(e.dataset.totalCount)||0,f.hasNextPage="true"===e.dataset.hasNextPage;try{f.pictures=JSON.parse(t.value||"[]")}catch(e){console.error("Failed to parse pictures data:",e),f.pictures=[]}m=f.hasNextPage}else console.error("Albums container not found");s(),i.click=function(e){var t=e.target.closest(".albums-view-btn, .albums-download-btn, .albums-share-btn");if(t)if(e.preventDefault(),e.stopPropagation(),t.classList.contains("albums-view-btn")){e=t.getAttribute("data-id");t.getAttribute("data-url");{var d=e;let r=[],c=0,o=document.querySelectorAll(".albums-picture-image-v2");if(o.forEach((e,t)=>{const o=e.closest(".albums-picture-card-v2");const n=o.getAttribute("data-id");const a=parseInt(e.getAttribute("data-width"))||e.naturalWidth;const i=parseInt(e.getAttribute("data-height"))||e.naturalHeight;const s=e.getAttribute("alt")||"";const l=e.src.replace("!albums","");r.push({src:l,w:a,h:i,title:s});if(n===d)c=t}),0===r.length)console.error("No images found for PhotoSwipe");else{e={index:c,bgOpacity:.85,showHideOpacity:!0,history:!0,modal:!0,focus:!0,shareEl:!1,fullscreenEl:!0,zoomEl:!0,counterEl:!0,arrowEl:!0,preloaderEl:!0,tapToClose:!1,tapToToggleControls:!0,clickToCloseNonZoomable:!1,closeOnScroll:!1,closeOnVerticalDrag:!0,mouseUsed:!1,escKey:!0,arrowKeys:!0,pinchToClose:!0,showAnimationDuration:400,hideAnimationDuration:350,spacing:.08,allowPanToNext:!0,loop:2<r.length,mainScrollEndFriction:.25,panEndFriction:.25,verticalDragRange:.8,maxSpreadZoom:2.5,getDoubleTapZoom:function(e,t){return e?1.8:t.initialZoomLevel<.7?1.5:2},preload:[1,3],closeElClasses:["item","caption","zoom-wrap","ui","top-bar"],getThumbBoundsFn:function(e){var t,e=o[e];return e?(t=window.pageYOffset||document.documentElement.scrollTop,{x:(e=e.getBoundingClientRect()).left,y:e.top+t,w:e.width}):null}};if("undefined"==typeof PhotoSwipe||"undefined"==typeof PhotoSwipeUI_Default)console.error("PhotoSwipe library not found");else{var a=document.querySelector("#gallery");if(a){let n=new PhotoSwipe(a,PhotoSwipeUI_Default,r,e);n.listen("gettingData",function(e,t){var o;(t.w<1||t.h<1)&&((o=new Image).onload=function(){t.w=this.width,t.h=this.height,n.updateSize(!0)},o.src=t.src)}),n.listen("afterChange",function(){w(n.getCurrentIndex(),r)}),n.listen("initialZoomIn",function(){let e=n.currItem;e&&e.container&&(e.container.style.opacity="0",requestAnimationFrame(()=>{e.container.style.transition="opacity 0.3s ease-out",e.container.style.opacity="1"}))}),n.listen("initialZoomInEnd",function(){var e=n.currItem;e&&e.container&&(e.container.style.transition="")}),n.listen("close",function(){var e=n.bg;e&&(e.style.transition="opacity 0.35s cubic-bezier(0.4, 0, 0.22, 1)")}),n.listen("beforeChange",function(e){if(1===Math.abs(e)){let e=n.container;e&&(e.style.transition="transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)",setTimeout(()=>{e.style.transition=""},400))}}),n.listen("imageLoadComplete",function(e,t){if(t.container){let e=t.container.querySelector("img");e&&(e.style.opacity="0",e.style.transition="opacity 0.3s ease-out",requestAnimationFrame(()=>{e.style.opacity="1"}))}}),n.listen("imageLoadError",function(e,t){console.warn("Image load error for item:",e,t.src)}),n.init(),w(c,r)}else console.error("PhotoSwipe gallery container not found")}}}}else if(t.classList.contains("albums-download-btn")){var a=t.getAttribute("data-url"),e=t.getAttribute("data-id"),o=a;try{var n=document.createElement("a");n.href=o,n.download=`image_${e}_${Date.now()}.jpg`,n.target="_blank",n.rel="noopener noreferrer",document.body.appendChild(n),n.click(),document.body.removeChild(n),c("图片下载开始")}catch(e){console.error("Download failed:",e),k("下载失败，请稍后重试")}}else if(t.classList.contains("albums-share-btn")){o=t.getAttribute("data-url"),e=t.getAttribute("data-description"),t=o;try{navigator.share?navigator.share({title:"分享图片",text:e||"来自相册的精美图片",url:t}):(r(t),c("图片链接已复制到剪贴板"))}catch(e){console.error("Share failed:",e),r(t),c("图片链接已复制到剪贴板")}}},document.addEventListener("click",i.click),i.load=function(e){e.target.classList.contains("albums-picture-image-v2")&&((e=e.target).style.opacity="1",e.closest(".albums-picture-card-v2").style.opacity="1",e.closest(".albums-picture-card-v2").style.transform="translateY(0)")},document.addEventListener("load",i.load,!0),i.error=function(e){var t;e.target.classList.contains("albums-picture-image-v2")&&((t=e.target).style.opacity="0.5",t.alt="图片加载失败",(e=parseInt(t.dataset.retryCount||"0"))<y.maxRetries?(t.dataset.retryCount=(e+1).toString(),setTimeout(()=>{t.src=t.src+"?retry="+Date.now()},y.retryDelay)):t.src="/core/images/image-error.png")},document.addEventListener("error",i.error,!0);{h.querySelectorAll(".albums-picture-card-v2").forEach((e,t)=>{e.style.animationDelay=t*y.animationDelay+"ms"});let e=null;i.resize=()=>{e&&clearTimeout(e),e=setTimeout(()=>{h.querySelectorAll(".albums-picture-card-v2").forEach((e,t)=>{e.style.animationDelay=t*(y.animationDelay/2)+"ms"})},300)},window.addEventListener("resize",i.resize)}if("IntersectionObserver"in window){var o=document.createElement("div"),n=(o.id="albums-sentinel",o.style.height="1px",o.style.width="100%",o.style.position="relative",o.style.clear="both",o.style.backgroundColor="transparent",document.getElementById("albumsLoading"));n&&n.parentNode?n.parentNode.insertBefore(o,n):(document.querySelector(".albums-container-v2")||document.body).appendChild(o),(g=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&m&&!u&&l()})},{root:null,rootMargin:y.loadThreshold+"px",threshold:.01})).observe(o)}else{let e=null;i.scroll=()=>{e&&clearTimeout(e),e=setTimeout(()=>{var e,t,o;e=window.pageYOffset||document.documentElement.scrollTop,t=window.innerHeight,o=document.documentElement.scrollHeight,(o-=e+t)<=y.loadThreshold&&m&&!u&&l()},100)},window.addEventListener("scroll",i.scroll)}if("IntersectionObserver"in window){let t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&((e=e.target).dataset.src&&(e.src=e.dataset.src,e.removeAttribute("data-src")),t.unobserve(e))})},{root:null,rootMargin:"50px",threshold:.1});document.querySelectorAll("img[data-src]").forEach(e=>{t.observe(e)})}document.querySelectorAll(".albums-picture-image-v2").forEach((e,t)=>{t<y.preloadCount&&((new Image).src=e.src)}),m?(v(),a&&(a.style.display="none")):(v(),b())}else console.error("Albums data not properly initialized")}catch(e){console.error("Failed to initialize albums page:",e)}}function s(){i.click&&(document.removeEventListener("click",i.click),i.click=null),i.load&&(document.removeEventListener("load",i.load,!0),i.load=null),i.error&&(document.removeEventListener("error",i.error,!0),i.error=null),i.resize&&(window.removeEventListener("resize",i.resize),i.resize=null),i.scroll&&(window.removeEventListener("scroll",i.scroll),i.scroll=null)}async function l(){if(!u&&m){u=!0,p&&(p.style.display="flex");try{var e=f.currentPage+1,t=await fetch(`/pages/albums?pageIndex=${e}&pageSize=`+f.pageSize);if(!t.ok)throw new Error("HTTP error! status: "+t.status);var o=await t.json(),n=(f.currentPage=o.currentPageIndex,f.hasNextPage=o.currentPageIndex<o.totalPageCount,m=o.currentPageIndex<o.totalPageCount,o.totalItemCount),a=o.currentPageIndex,i=document.getElementById("totalCount"),s=document.getElementById("currentPage");if(i&&(i.textContent=n),s&&(s.textContent=a),0<o.items.length){var l=o.items,r=document.createDocumentFragment();for(let e=0;e<l.length;e++){var c=(e=>{var t=document.createElement("div"),o=(t.className="albums-picture-card-v2",e.Id||e.id),n=e.AccessUrl||e.accessUrl,a=e.Description||e.description,i=e.Width||e.width,s=e.Height||e.height,l=e.Tags||e.tags,r=e.Creator||e.creator,c=e.Length||e.length,e=e.UploadTime||e.uploadTime,l=(t.setAttribute("data-id",o),l&&0<l.length?`<div class="albums-picture-tags-v2">
                ${l.map(e=>`<span class="ds-badge ds-badge-primary albums-tag-v2">#${e}</span>`).join("")}
               </div>`:""),d=a?`<div class="albums-picture-description-v2">
                <p class="ds-text-body">${C(a)}</p>
               </div>`:"",u=r?.Avatar||r?.avatar||"/core/images/default-avatar.png",c=(c/1024/1024).toFixed(2);return t.innerHTML=`
            <div class="albums-picture-wrapper-v2">
                <img 
                    src="${n}!albums" 
                    alt="${C(a||"")}" 
                    class="albums-picture-image-v2"
                    data-width="${i}"
                    data-height="${s}"
                    loading="lazy"
                />
                <div class="albums-picture-overlay-v2">
                    <div class="albums-picture-actions-v2">
                        <button class="albums-action-btn-v2 albums-view-btn" data-id="${o}" data-url="${n}">
                            <i class="fa fa-eye"></i>
                        </button>
                        <button class="albums-action-btn-v2 albums-download-btn" data-url="${n}" data-id="${o}">
                            <i class="fa fa-download"></i>
                        </button>
                        <button class="albums-action-btn-v2 albums-share-btn" data-url="${n}" data-description="${C(a||"")}">
                            <i class="fa fa-share"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="albums-picture-info-v2">
                ${d}
                ${l}
                
                <div class="albums-picture-meta-v2">
                    <div class="albums-picture-user-v2">
                        <img 
                            src="${u}" 
                            alt="${C(r?.Name||r?.name||"")}" 
                            class="albums-user-avatar-v2"
                        />
                        <div class="albums-user-info-v2">
                            <span class="albums-user-name-v2">${C(r?.Name||r?.name||"")}</span>
                            <span class="albums-upload-time-v2">${(t=>{try{var e=new Date(t),o=new Date-e,n=Math.floor(o/864e5);return 0===n?"今天":1===n?"昨天":n<7?n+"天前":e.toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(e){return t}})(e)}</span>
                        </div>
                    </div>
                    <div class="albums-picture-size-v2">
                        <span class="ds-text-caption">${i} × ${s}</span>
                        <span class="ds-text-caption">${c} MB</span>
                    </div>
                </div>
            </div>
        `,t})(l[e]);c.style.animationDelay=e*y.animationDelay+"ms",r.appendChild(c)}h.appendChild(r),await 0;var d=o.items.map(e=>({id:e.Id||e.id,url:e.AccessUrl||e.accessUrl,description:e.Description||e.description,width:e.Width||e.width,height:e.Height||e.height}));f.pictures=f.pictures.concat(d)}setTimeout(()=>{var e,t;v(),m?(t=document.getElementById("albums-sentinel"))&&(e=document.getElementById("albumsLoading"))&&e.parentNode&&t.parentNode&&t.nextSibling!==e&&e.parentNode.insertBefore(t,e):(b(),g&&(g.disconnect(),g=null),(t=document.getElementById("albums-sentinel"))&&t.parentNode&&t.parentNode.removeChild(t))},y.loadDelay)}catch(e){console.error("Failed to load more images:",e),v(),k("加载失败，请稍后重试")}finally{u=!1}}}function v(){p&&(p.style.display="none")}function b(){a&&(a.style.display="flex")}function w(e,t){[e-1,e+1].forEach(e=>{0<=e&&e<t.length&&((new Image).src=t[e].src)})}function r(e){if(navigator.clipboard)navigator.clipboard.writeText(e);else{var t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),Promise.resolve()}catch(e){return Promise.reject(e)}finally{document.body.removeChild(t)}}}function c(e){t(e,"success")}function k(e){t(e,"error")}function t(e,t="info"){let o=document.createElement("div");o.className="albums-message-v2 albums-message-"+t,o.textContent=e,o.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            background: ${"success"===t?"#10b981":"error"===t?"#ef4444":"#3b82f6"};
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        `,document.body.appendChild(o),setTimeout(()=>{o.style.transform="translateX(0)"},100),setTimeout(()=>{o.style.transform="translateX(100%)",setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},300)},3e3)}function C(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}function o(){g&&(g.disconnect(),g=null);var e=document.getElementById("albums-sentinel");e&&e.parentNode&&e.parentNode.removeChild(e),s(),u=!1,m=!0,f={currentPage:1,pageSize:20,totalPages:1,totalCount:0,hasNextPage:!1,pictures:[]},p=null,a=null,h=null}window.addEventListener("beforeunload",window.cleanupAlbums),window.initAlbums=function(){if(!document.querySelector(".albums-container-v2"))return!1;(g||h)&&o();try{return e(),!0}catch(e){return console.error("Failed to initialize albums:",e),!1}},window.cleanupAlbums=function(){(g||h)&&o()},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",window.initAlbums):window.initAlbums()})();
//# sourceMappingURL=site.min.js.map