function loadImages(t){var o=[];for(let e=0;e<t.length;e++){let a=t[e];var n=new Promise((e,t)=>{a.complete?e(a):(a.addEventListener("load",function(){(a.complete?e:t)(a)}),a.addEventListener("error",function(){console.warn(`the image [${a.src}] loaded error.`),t(a)}))});o.push(n)}return Promise.all(o)}function lightCode(){document.querySelectorAll("pre code").forEach(e=>{Prism.highlightElement(e)}),codeBlockTools()}function codeBlockTools(){$("pre[class*=language-]").wrap('<div class="code-area" style="position: relative"></div>');var e=$('<i class="fa fa-angle-up fa-fw code-expand" aria-hidden="true" title="折叠"></i>'),e=($(".code-area").prepend(e),$(".code-expand").on("click",function(){$(this).parent().hasClass("code-closed")?($(this).siblings("pre").find("code").show(),$(this).siblings("pre").find(".line-highlight").show(),$(this).parent().removeClass("code-closed")):($(this).siblings("pre").find("code").hide(),$(this).siblings("pre").find(".line-highlight").hide(),$(this).parent().addClass("code-closed"))}),$('<i class="fa fa-copy fa-fw code_copy" title="复制代码" aria-hidden="true"></i>')),t=$('<div class="codecopy_notice"></div>');$(".code-area").prepend(e),$(".code-area").prepend(t),$(".code-area .fa-copy").on("click",function(){var e=window.getSelection(),t=document.createRange();t.selectNodeContents($(this).siblings("pre").find("code")[0]),e.removeAllRanges(),e.addRange(t),e.toString();if(document.queryCommandSupported&&document.queryCommandSupported("copy"))try{document.execCommand("copy"),layer.msg("复制成功")}catch(e){layer.msg("复制失败")}else layer.msg("浏览器不支持");e.removeAllRanges()});e=$('<div class="code_lang" title="代码语言"></div>'),t=$("pre");t.before(e),t.each(function(){var e;for(e of $(this).prop("class").split(/\s+/))if(e.startsWith("language")){var t=e.replace("language-","").trim();$(this).siblings(".code_lang").text(t);break}})}function outPutSuccess(e){console.log(`%c Success %c [${moment().format("YYYY-MM-DD HH:mm:ss")}]  %c `+e,"color: #bb0662; background: #030307; padding:5px 0;","color: #fadfa3; background: #393d49; padding:5px 0","font-weight:bold; color: black; background: #77f2e1; padding:5px 0;")}function outPutInfo(e){console.log(`%c Info %c [${moment().format("YYYY-MM-DD HH:mm:ss")}]  %c `+e,"color: #bb0662; background: #030307; padding:5px 0;","color: #fadfa3; background: #393d49; padding:5px 0","font-weight:bold; color: black; background: #fadfa3; padding:5px 0;")}function outPutError(e){console.log(`%c Error %c [${moment().format("YYYY-MM-DD HH:mm:ss")}]  %c `+e,"color: #bb0662; background: #030307; padding:5px 0;","color: #fadfa3; background: #393d49; padding:5px 0","font-weight:bold; color: black; background: red; padding:5px 0;")}function ajaxFail(e,t,a){console.log(e),console.log(t),console.log(a),e.hasOwnProperty("responseJSON")&&e.responseJSON.hasOwnProperty("success")&&e.responseJSON.hasOwnProperty("msg")&&!1===e.responseJSON.success?layer.alert(e.responseJSON.msg):layer.msg("error:"+e.status)}(async()=>{var e;codeBlockTools(),moment.locale("zh-cn"),new LazyLoad({}),"granted"!==Notification.permission&&(e=await Notification.requestPermission(function(e){"granted"===e&&console.info("通知已授权")}),console.log(e))})(),$.fn.relativeTime=function(){this.each(function(e){var t,a;void 0===$(this).data("timeStatus")&&(a=$(this).attr("datetime"),t=$(this).text(),a=moment(a,"YYYY/MM/DD HH:mm:ss").fromNow(),$(this).text(a).attr("title",t).data("timeStatus","loaded"))})};let videoItems=[];async function initVideoPlayer(){var e=document.getElementById("video-player")||document.getElementById("m-video-player");if(null!==e){if(0===videoItems.length)try{var t=await fetch(dpzOption.webApiBaseAddress+"/api/Video",{method:"GET",headers:{"Content-Type":"application/json"},mode:"cors"});videoItems=await t.json()}catch(e){console.log(e)}if(0===videoItems.length)return;e.style.marginBottom="1em",window.innerWidth<=550&&(e.style.marginBottom="4em"),e.style.aspectRatio="16/9";t=Math.floor(Math.random()*videoItems.length);videoPlayer(e,videoItems[t].m3u8,videoItems[t].id)}e=document.querySelector("[data-watch-video]");null!==e&&(t=JSON.parse(e.dataset.watchVideo),e.style.marginBottom="1em",e.style.aspectRatio="16/9",videoPlayer(e,t.url,t.id))}function videoPlayer(e,t,a){new Artplayer({container:e,url:t,type:"m3u8",fullscreenWeb:!0,fullscreen:!0,customType:{m3u8:function(t,a,o){if(Hls.isSupported()){o.hls&&o.hls.destroy();let e=new Hls;e.loadSource(a),e.attachMedia(t),o.hls=e,o.on("destroy",()=>e.destroy())}else t.canPlayType("application/vnd.apple.mpegurl")?t.src=a:o.notice.show="Unsupported playback format: m3u8"}},plugins:[artplayerPluginDanmuku({danmuku:async function(){return(await fetch("/history/danmaku/v2/"+a)).json()}})],controls:[]}).on("artplayerPluginDanmuku:emit",async e=>{e.id=a,await fetch("/send/danmaku/v2",{method:"post",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)})})}async function initFetchContent(){var e,t;for(e of document.querySelectorAll("[data-request]"))"loaded"!==e.dataset.status&&(t=await fetch(e.dataset.request,{method:"GET"}),e.dataset.status="loaded",e.innerHTML=await t.text(),$("time.timeago").relativeTime(),lightCode())}function generateToc(){var e=$(".js-toc");0!==e.length&&(0===$(".article-detail-content").find("h1,h2,h3").length?(tocbot.destroy(),$("label.toc-icon.menu").hide(),e.hide()):tocbot.init({tocSelector:".js-toc",contentSelector:".article-detail-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0}))}let dpzOption={webApiBaseAddress:document.querySelector("meta[name=web-api-base-address]").content,CDNBaseAddress:document.querySelector("meta[name=cdn-base-address]").content,isDark:window.matchMedia("(prefers-color-scheme: dark)").matches};function leftIn(){$(".blog-mask").unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend"),$(".blog-nav-left").unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend"),$(".blog-mask").removeClass("maskOut"),$(".blog-mask").addClass("maskIn"),$(".blog-mask").removeClass("layui-hide"),$(".blog-mask").addClass("layui-show"),$(".blog-nav-left").removeClass("leftOut"),$(".blog-nav-left").addClass("leftIn"),$(".blog-nav-left").removeClass("layui-hide"),$(".blog-nav-left").addClass("layui-show")}function leftOut(){$(".blog-mask").on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(".blog-mask").addClass("layui-hide")}),$(".blog-nav-left").on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(".blog-nav-left").addClass("layui-hide")}),$(".blog-mask").removeClass("maskIn"),$(".blog-mask").addClass("maskOut"),$(".blog-mask").removeClass("layui-show"),$(".blog-nav-left").removeClass("leftIn"),$(".blog-nav-left").addClass("leftOut"),$(".blog-nav-left").removeClass("layui-show")}function categroyIn(){$(".category-toggle").addClass("layui-hide"),$(".article-category").unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend"),$(".article-category").removeClass("categoryOut"),$(".article-category").addClass("categoryIn"),$(".article-category").addClass("layui-show")}function categoryOut(){$(".article-category").on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(".article-category").removeClass("layui-show"),$(".category-toggle").removeClass("layui-hide")}),$(".article-category").removeClass("categoryIn"),$(".article-category").addClass("categoryOut")}function pjaxCompleteInit(){lightCode(),generateToc(),$("time.timeago").relativeTime(),initVideoPlayer().catch(e=>console.log(e)),initFetchContent().catch(e=>console.log(e))}async function showNotify(e){var t,a;return"Notification"in window&&(t=await Notification.requestPermission(),a={title:"",content:"",image:"https://cdn.dpangzi.com/logo.png"},$.extend(a,e),"granted"===t)?new Notification(a.title,{icon:a.image,body:a.content,lang:"zh-cn",tag:a.tag}):null}dpzOption.isDark&&document.querySelector("#layui_theme_css").setAttribute("href",dpzOption.CDNBaseAddress+"/lib/layui/css/layui-theme-dark.css"),(async()=>{var e=await(await fetch("/account/GetUserInfo")).json();e.success&&$(".blog-user").attr("href","/account").find("img").attr({src:""+e.data.avatar,title:e.data.name});let i=".article.shadow .article-left img,.mumble-list .mumble-item .mumble-content img,.article-detail-content img,#cd-timeline .content img",t=($(document).delegate(i,"click",function(){let e=layer.load(1),n=$(i);loadImages(n).then(t=>{var a=[];for(let e=0;e<t.length;e++){var o=t[e];a.push({src:o.src,w:o.naturalWidth,h:o.naturalHeight,title:o.alt})}var e={index:n.index(this),bgOpacity:.7,showHideOpacity:!0,history:!0,getThumbBoundsFn:function(e){var e=document.querySelectorAll(i)[e],t=window.pageYOffset||document.documentElement.scrollTop,e=e.getBoundingClientRect();return{x:e.left,y:e.top+t,w:e.width}}};new PhotoSwipe(document.getElementById("gallery"),PhotoSwipeUI_Default,a,e).init()}).finally(()=>layer.close(e))}),$(document).delegate("#i-search","submit",function(){var e=$("#i-keyword").val(),t=$(this).find("[name=q]");$(this).find("[name=q]").val(t.data("default")+" "+e)}),$(document).delegate("#i-keyword","keyup",function(e){13===e.keyCode&&$(this).parents("form").submit()}),$(document).delegate("#i-search a.search-btn","click",function(){$(this).parents("form").submit()}),$(document).delegate("[title]:not(.react-jinke-music-player-main *)","touchend",function(){var e=$(this).attr("title");layer.tips(e,this,{tips:3})}),e=await(await fetch("/Music/Recommend/v2")).json(),ReactJkMusicPlayer.defaultProps.quietUpdate=!0,ReactJkMusicPlayer.defaultProps.locale="zh_CN",ReactJkMusicPlayer.defaultProps.defaultPosition={bottom:0,left:0},ReactJkMusicPlayer.defaultProps.preload=!0,ReactJkMusicPlayer.defaultProps.glassBg=!0,ReactJkMusicPlayer.defaultProps.autoPlay=!1,ReactJkMusicPlayer.defaultProps.remove=!1,ReactJkMusicPlayer.defaultProps.showMiniProcessBar=!0,ReactJkMusicPlayer.defaultProps.showDownload=!1,ReactJkMusicPlayer.defaultProps.showLyric=!0,ReactJkMusicPlayer.defaultProps.showMediaSession=!0,ReactJkMusicPlayer.defaultProps.showDestroy=!1,ReactJkMusicPlayer.defaultProps.showReload=!1,ReactJkMusicPlayer.defaultProps.volumeFade={fadeIn:300,fadeOut:300},ReactJkMusicPlayer.defaultProps.sortableOptions={disabled:!0,forceFallback:!0},ReactJkMusicPlayer.defaultProps.audioLists=e,ReactDOM.render(React.createElement(ReactJkMusicPlayer),document.getElementById("music-player")),null);function a(e){clearTimeout(t),t=setTimeout(function(){0<window.scrollY?$(".blog-nav").css({"background-color":"rgba(57,61,73,.5)","backdrop-filter":"blur(25px)"}):0===window.scrollY&&$(".blog-nav").css({"background-color":"rgb(57,61,73)","backdrop-filter":"none"})},100)}$(window).off("scroll",a).on("scroll",a)})(),layui.use(["element","layer","carousel","util","flow","form","upload"],function(){let t=layui.layer,e=layui.flow,a=layui.util;if(a.fixbar({bar1:"&#xe64a;",css:{bottom:55},click:function(e){if("bar1"===e){let e=t.load(),o=(console.log(event),event.target||event.srcElement);$.ajax({url:"/Home/TodayWallpaper"}).done(function(e){var t,a=[];for(t of e)a.push({src:t.url.replaceAll("1920x1080","UHD"),w:1920,h:1080,title:t.copyRight});e={index:0,bgOpacity:.7,showHideOpacity:!0,history:!0,getThumbBoundsFn:function(e){var t=window.pageYOffset||document.documentElement.scrollTop,a=o.getBoundingClientRect()||{left:0,top:0,width:0};return{x:a.left,y:a.top+t,w:a.width}}};new PhotoSwipe(document.getElementById("gallery"),PhotoSwipeUI_Default,a,e).init()}).always(function(){t.close(e)})}}}),e.lazyimg(),!1===layui.device().mobile)try{let t=document.querySelector("#can-back-round");var o=t.getBoundingClientRect();t.width=o.width,t.height=o.height;let a=new RaindropFX({canvas:t,background:dpzOption.isDark?"https://cdn.dpangzi.com/wallpaper.jpg":dpzOption.CDNBaseAddress+"/../images/background.jpg"});window.onresize=()=>{var e=t.getBoundingClientRect();a.resize(e.width,e.height)},a.start()}catch(e){console.log(e)}}),$(document).delegate(".blog-navicon","click",function(){(new RegExp("layui-hide").test($(".blog-nav-left").attr("class"))?leftIn:leftOut)()}),$(document).delegate(".blog-mask","click",function(){leftOut()}),$(document).delegate(".category-toggle","click",function(){categroyIn()}),$(document).delegate(".article-category","click",function(){categoryOut()}),$(document).delegate(".article-category > a","click",function(){$(".article-category > a").removeClass("tag-this"),$(this).addClass("tag-this")}),layui.use(["element"],function(){let a=layui.element,o=layui.form,n=void($.pjax.defaults.timeout=2e4,$(document).pjax("nav.blog-nav ul.layui-nav>li>a,a[data-pjax]",".blog-body"),$(document).pjax("#blog-list a,.tags a",".blog-main-left"),$(document).pjax("#articl-comment a","#blog-comment",{scrollTo:!1}),$(document).pjax("#talk-pager a",".mumble-list"),$(document).pjax("#topic-list a",".blog-main-left"),$(document).pjax(".bookmark .category-box a.category",".blog-body"),$(document).pjax(".code-box .box-rows .row .header a",".code-box .box-rows"),$.support.pjax&&$(".tags a").on("click",function(e){$(".tags a").removeClass("tag-this"),$(this).addClass("tag-this");$.pjax.click(e,{container:".blog-main-left"})}),pjaxCompleteInit(),$(document).on("pjax:send",function(){NProgress.start()})),e=($(document).on("pjax:complete",function(e,t){""===(n=t.getResponseHeader("title"))||null===n?document.title="（；´д｀）ゞ标题不见啦 - 叫我阿胖":document.title=Base64.decode(n),a.render(),o.render(),categoryOut(),leftOut(),pjaxCompleteInit(),NProgress.done()}),new LazyLoad({}));$(document).on("pjax:end",function(){e.update()})}),(async()=>{let e=(new signalR.HubConnectionBuilder).withUrl("/notification",{skipNegotiation:!0,transport:signalR.HttpTransportType.WebSockets}).withAutomaticReconnect().build();try{await e.start(),await e.invoke("Init")}catch(e){console.error(e)}e.on("pushMessage",async function(e){var t=await showNotify({title:"小喇叭开始广播辣",content:e.markdown});null!==t&&(t.onclick=function(){window.open("/talk.html")}),console.info(e)}),e.on("pushLogMessage",function(e,t){0===e?(outPutSuccess(t),$.notify(moment().format("YYYY-MM-DD HH:mm:ss")+`
`+t,"success")):1===e?(outPutInfo(t),$.notify(moment().format("YYYY-MM-DD HH:mm:ss")+`
`+t,"warn")):2===e&&(outPutError(t),$.notify(moment().format("YYYY-MM-DD HH:mm:ss")+`
`+t,"error"))});let n=null;function a(){e.invoke("getRunTime")}e.on("cnBetaSubscribe",function(t){var a=[];if(t.hasOwnProperty("progressValues")&&Array.isArray(t.progressValues))for(let e=0;e<t.progressValues.length;e++){var o=(100*t.progressValues[e]).toFixed(2);a.push(parseFloat(o))}switch(null==n?n=notification.show({title:"CnBeta发布",content:t.message,bars:a}):(notification.setContent(n,t.message),notification.setProgress(n,a)),t.type){case 0:outPutSuccess(t.message);break;case 1:outPutInfo(t.message);break;case 2:outPutError(t.message);break;case 3:outPutSuccess(t.message),setTimeout(function(){notification.close(n),n=null},1e3)}}),e.on("ready",function(e){console.info(e)}),setTimeout(function(){a()},1e3),e.on("ReceiveRunTime",function(e){var t=$("#runTime");0<t.length&&(t.text("运行时间 "+e),setTimeout(a,1e3))}),e.on("systemNotification",function(e){layer.msg(e)})})(),(async()=>{var e=(new signalR.HubConnectionBuilder).withUrl("/app/notification",{skipNegotiation:!0,transport:signalR.HttpTransportType.WebSockets}).withAutomaticReconnect().build();try{await e.start()}catch(e){console.error(e)}e.on("systemMessage",function(e,t){0===e?(outPutSuccess(t),$.notify(t,"success")):1===e?(outPutInfo(t),$.notify(t,"warn")):2===e&&(outPutError(t),$.notify(t,"error"))})})();let notification={show:function(e){"object"!=typeof e&&(e={});let s={title:"",content:"",bars:[]},t=($.extend(s,e),0);$(".notification-box").each(function(){t+=$(this).height()+15});e=((e,t)=>{var a=$("<div>").addClass("notification-box"),e=$("<div>").addClass("title").text(e),o=(a.append(e),$("<div>").addClass("content-container")),e=$("<span>").addClass("content").text(t),n=(o.append(e),(t=>{var a=[];if(Array.isArray(t))for(let e=0;e<t.length;e++)"number"==typeof t[e]&&a.push(t[e]);return a})(s.bars));for(let e=0;e<n.length;e++){var i=$("<div>").addClass("progress"),l=n[e]+"%",l=$("<div>").addClass("bar").css("width",l).text(l);i.append(l),o.append(i)}return a.append(o),a})(s.title,s.content);return e.css("top",t+15+"px"),$("body").append(e),e},setContent:function(e,t){0!==e.length&&e.find(".content").text(t)},setTitle:function(e,t){0!==e.length&&e.find(".title").text(t)},setProgress:function(a,o){if(0!==a.length&&Array.isArray(o)){let t=0;for(let e=0;e<o.length;e++)"number"==typeof o[e]&&(a.find(`.content-container .progress:eq(${t}) .bar`).css("width",o[e]+"%").text(o[e]+"%"),t++)}},close:function(e){0!==e.length&&e.fadeOut("fast",function(){e.remove()})},closeAll:function(){$(".notification-box").fadeOut("fast",function(){$(".notification-box").remove()})},test:function(){let t=notification.show({title:"这是标题呀",content:"内容",bars:[0]}),a=(setTimeout(function e(){if(100<=a)return notification.setContent(t,"加载完毕，即将关闭！"),void notification.close(t);a++;notification.setContent(t,"新内容呀\n"+a);notification.setProgress(t,[a]);setTimeout(e,100)},100),0)}},layImConfig=((()=>{let n="";$(document).delegate(".bookmark .search-box input[type=search]","input",function(){n=$(this).val();let e=[];$(".bookmark .category-box .category.active").each(function(){e.push($(this).text())}),$.ajax({type:"get",url:"/bookmark/search",traditional:!0,data:{title:n,categories:e}}).done(function(e){if(e.success){$(".bookmark .search-box .search-result").show();var t,a=[];for(t of e.data)a.push(`<li>${t}</li>`);$(".bookmark .search-box .search-result ul").html(a.join(""))}})}),$(document).delegate(".bookmark .search-box input[type=search]","keyup",function(t){if(13===t.keyCode){t=$(this).val();let e=[];$(".bookmark .category-box .category.active").each(function(){e.push("categories="+encodeURIComponent($(this).text()))}),""===t.trim()&&0===e.length?$.pjax({url:"/bookmark.html",container:".blog-body"}):""===t.trim()&&0!==e.length?$.pjax({url:"/bookmark.html?"+e.join("&"),container:".blog-body"}):""!==t.trim()&&0===e.length?$.pjax({url:"/bookmark.html?title="+encodeURIComponent(t),container:".blog-body"}):$.pjax({url:`/bookmark.html?title=${encodeURIComponent(t)}&`+e.join("&"),container:".blog-body"})}}),$(document).delegate(".bookmark .search-box .search-result ul li","click",function(){var e=$(this).text();let t=[];$(".bookmark .category-box .category.active").each(function(){t.push("categories="+encodeURIComponent($(this).text()))}),0===t.length?$.pjax({url:"/bookmark.html?title="+encodeURIComponent(e),container:".blog-body"}):$.pjax({url:`/bookmark.html?title=${encodeURIComponent(e)}&`+t.join("&"),container:".blog-body"})}),$(document).delegate(".bookmark .search-box input[type=search]","blur",function(){setTimeout(function(){$(".bookmark .search-box .search-result").hide()},300)}),$(document).delegate(".bookmark .search-box input[type=search]","focus ",function(){0<$(".bookmark .search-box .search-result ul li").length&&$(".bookmark .search-box .search-result").show()}),$(document).delegate(".bookmark .search-box input[type=search]","keydown",function(e){var t,a=$(".bookmark .search-box .search-result ul li"),o=$(".bookmark .search-box .search-result ul li.selected");40===e.keyCode?(e.preventDefault(),0===o.length?((t=a.first()).addClass("selected"),$(this).val(t.text())):$(".bookmark .search-box .search-result ul li:last").hasClass("selected")?(a.removeClass("selected"),$(this).val(n)):(t=o.next(),a.removeClass("selected"),0<t.length&&(t.addClass("selected"),$(this).val(t.text())))):38===e.keyCode&&(e.preventDefault(),0===o.length?((t=a.last()).addClass("selected"),$(this).val(t.text())):$(".bookmark .search-box .search-result ul li:first").hasClass("selected")?(a.removeClass("selected"),$(this).val(n)):(e=o.prev(),a.removeClass("selected"),0<e.length&&(e.addClass("selected"),$(this).val(e.text()))))}),$(document).delegate(".bookmark .category-box .category","click",function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active")}),$(document).delegate("form.bookmark-create","submit",function(){var e=new FormData(this);let o=$(this);return $(this).find("button[lay-submit]").addClass("layui-btn-disabled").attr("disabled","disabled").html('<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop layui-font-12"></i> 正在提交'),$.ajax({url:o.attr("action"),processData:!1,contentType:!1,data:e,type:"post"}).done(function(e,t,a){e.success?(o[0].reset(),layer.closeAll(),$.pjax({url:"/bookmark.html",container:".blog-body"})):layer.alert(e.msg)}).fail(ajaxFail),!1}),layui.use(["element","layer","carousel","util","flow","form","upload"],function(){let o=layui.form;$(document).delegate(".bookmark-setting[data-id]","click",function(){var e=$(this).data("id");let t=layer.load(),a=600<$(window).width()?"600px":"100%";$.ajax({url:"/bookmark/update/"+e,type:"get"}).done(function(e){"object"==typeof e?e.success||layer.msg(e.msg):layer.open({type:1,content:e,area:a,success:function(){o.render()}})}).always(function(){layer.close(t)}).fail(ajaxFail)})}),$(document).delegate("form.bookmark-create button[data-delete]","click",function(){let e=layer.load();$.ajax({url:"/bookmark/delete",type:"post",data:{id:$(this).data("delete")}}).done(function(){layer.closeAll(),$.pjax({url:"/bookmark.html",container:".blog-body"})}).always(function(){layer.close(e)})})})(),$(document).delegate(".comments-area .load-more button","click",function(){let o=$(this).parents(".comments-area"),n=$(this).parent(),i=$(this).parents().find(".comment-count span");var e=$(this).parent().data("loadingIco"),e=(n.html(`<img src="${e}" class="comment-loading" alt="loading"/>`),parseInt($(this).data("pageIndex"))),t=parseInt($(this).data("pageSize")),a=$(this).data("pageRequest");$(this);$.ajax({url:a,type:"get",data:{pageIndex:e+1,pageSize:t}}).done(function(e,t,a){o.append(e),n.remove(),i.text(a.getResponseHeader("commentCount")),$("time.timeago").relativeTime(),lightCode()}).fail(ajaxFail)}),$(document).delegate("form.comment-form :input:not(textarea)","keydown",function(e){return"Enter"!==e.key}),$(document).delegate("form.comment-form","submit",function(){event.preventDefault();var e=new FormData(this);let l=$(this),s=$(this).parents(".comment-block").find(".comment-count span");$(this).find("button.layui-btn.layui-btn-sm").addClass("layui-btn-disabled").attr("disabled","disabled").html('<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop layui-font-12"></i> 发送'),$.ajax({url:l.attr("action"),processData:!1,contentType:!1,data:e,type:"post"}).done(function(e,t,a){var o,n,i;e.hasOwnProperty("success")&&!1===e.success?layer.msg(e.msg,{icon:2,anim:6}):(o=l.clone(),i=(n=l.parents(".comment-block")).find(".comments-area:first"),n.find(".comments-area").html(e),l.remove(),o.find("textarea").val(""),o.find("button.layui-btn.layui-btn-sm").removeClass("layui-btn-disabled").removeAttr("disabled").html("发送"),o.find("input[name=replyId]").val(""),o.find(".comment-btn-close").hide(),o.find(".comment-btn-close").unbind("click"),i.before(o),s.text(a.getResponseHeader("commentCount")),$("time.timeago").relativeTime(),lightCode())}).always(function(){l.find("button.layui-btn.layui-btn-sm").removeClass("layui-btn-disabled").removeAttr("disabled").html("发送")})}),$(document).delegate(".comment-count button.refresh","click",function(){let o=$(this).parents(".comment-block").find(".comments-area");var e=$(this).data("refresh")+"?t="+(new Date).getTime();let n=$(this).parent().find("span"),t=layer.load();$.ajax({url:e,type:"get"}).done(function(e,t,a){o.html(e),n.text(a.getResponseHeader("commentCount")),$("time.timeago").relativeTime(),lightCode()}).fail(ajaxFail).always(function(){layer.close(t)})}),$(document).delegate(".footer-action-item[data-image]","click",function(){let o=$(this).parents().find("textarea.comment-form-editor");layer.prompt({title:"请输入网络图片地址"},function(e,t){let a;try{a=new URL(e)}catch{return void layer.msg("请输入正确的地址嗷~")}"https:"!==a.protocol?layer.msg("使用https协议的网络图片嗷~"):(e=`![](${a.toString()})`,o.val(o.val()+"\r\n"+e),layer.close(t))})}),$(document).delegate(".comments-area blockquote.comment-item button.btn-reply","click",function(){var e=$(this).parents(".comment-block").find("form.comment-form");let t=e.clone(),a=(e.remove(),$(this));t.find("input[name=replyId]").val($(this).data("replyId")),t.find(".comment-btn-close").show(),t.find(".comment-btn-close").bind("click",function(){t.find("input[name=replyId]").val(""),a.parents(".comments-area").before(t),$(this).hide(),$(this).unbind("click")}),$(this).parents(".comment-block blockquote.comment-item:first").find(".detail > .comment-content:first").after(t)}),$(document).delegate("[data-likeid]","click",function(){let t=$(this),e=layer.load(1);$.ajax({url:"/Talk/Like",data:{id:t.data("likeid")},type:"post"}).done(function(e){e.success?t.find("[data-number]").text(e.data):layer.msg(e.msg,{icon:2,anim:6})}).always(function(){layer.close(e)})}),$(document).delegate(".mumble-more a","click",function(){var e=$(this).parents(".mumble-more"),t=$(this).parents(".mumble-item").find(".mumble-content");e.hasClass("mumble-pack-up")?(e.removeClass("mumble-pack-up"),t.addClass("mumble-hide-sub"),$(this).html('查看更多<i class="layui-icon layui-icon-down">')):(e.addClass("mumble-pack-up"),t.removeClass("mumble-hide-sub"),$(this).html('收起<i class="layui-icon layui-icon-up">'))}),$(document).delegate("[data-comment-id]","click",function(){let o=$(this),n=o.parents("div.mumble-item").find("div.mumble-comment[data-talk-id]");if(n.hide("fast",function(){$(this).html("")}),o.parent().hasClass("mumble-active"))o.parent().removeClass("mumble-active");else{o.parent().addClass("mumble-active");let e=layer.load(1);$.ajax({url:"/Comment/Mumble/"+o.data("commentId"),type:"get"}).done(function(e,t,a){o.find("[data-comment-count]").text(a.getResponseHeader("commentCount")),n.html(e),lightCode(),n.show(),o.parents(".comment-parent").find("time.timeago").relativeTime()}).always(function(){layer.close(e)})}}),{contactsPanel:{showFriend:!0,showGroup:!0,minStatus:!0},pageurl:{chatlog:function(e){e=e.receiver;return`/chat/record/${e.id}?type=`+e.type}},init:{url:"/chat/init"},theme:dpzOption.isDark?"dark":"light"}),chatTools=[{name:"code",title:"插入代码",icon:"layui-icon-fonts-code",onClick:function(a){layer.prompt({title:"插入代码",formType:2},function(e,t){layer.close(t),e=["```",e,"```"].join("\n"),a.insert(e)})}},{name:"clear",title:"清除聊天记录",icon:"layui-icon-clear",onClick:function(e){console.log(e)}}],converter=new showdown.Converter({openLinksInNewWindow:!0,simplifiedAutoLink:!0,splitAdjacentBlockquotes:!0,strikethrough:!0,tables:!0,tasklists:!0});async function loadMembers(e){var t=await(await fetch("/chat/groupMembers/"+e.receiver.id,{method:"GET"})).json();e.render(t.data)}async function getSignalRConnection(e){e=(new signalR.HubConnectionBuilder).withUrl(e,{skipNegotiation:!0,transport:signalR.HttpTransportType.WebSockets}).withAutomaticReconnect().build();try{await e.start()}catch(e){console.error(e)}return e}layui.config({layimPath:dpzOption.CDNBaseAddress+"/lib/layim/",layimResPath:dpzOption.CDNBaseAddress+"/lib/layim/res/"}).extend({layim:dpzOption.CDNBaseAddress+"/lib/layim/layim"}).use(["layim","layer"],async function(){if(!0!==layui.device().mobile){let t=layui.layim,o=layui.layer,n=(t.callback("contentParser",e=>{e=$("<div>").html(e),e=$("<div>").text(e.html()).html(),e=converter.makeHtml(e),e=$(`<div><div class="markdown-body">${e}</div></div>`);return e.find("pre code").each(function(e,t){console.log(t),$(t).parents("pre").attr("style","padding:1em !important;"),Prism.highlightElement(t);t=$(t);t.replaceWith("<div>"+t.html()+"</div>")}),e.html()}),t.config(layImConfig),t.extendChatTools(chatTools),t.on("sign",async function(e){try{var t=new FormData;t.append("sign",e);var a=await(await fetch("/Account/UpdateSign",{method:"POST",body:t})).json();a.success||o.msg(a.msg)}catch(e){console.error(e)}}),await getSignalRConnection("/chatHub")),i=await getSignalRConnection("/robotChat");n.on("ReceiveMessage",function(e){e.timestamp=1e3*e.timestamp,t.getMessage(e)}),i.on("Answer",function(e){console.log(e),t.getMessage(e)}),i.on("SystemError",function(e){console.error(e),t.getMessage(e)}),n.on("System",function(e){e.code<0?(outPutError(e.content),n.stop()):0!==e.code||e.isGuest?1===e.code&&(o.msg(e.user.name+"上线了"),t.setFriendStatus(e.user.id,"online")):(o.msg(e.user.name+"下线了"),t.setFriendStatus(e.user.id,"offline"))}),t.on("sendMessage",async function(e){var t=e.receiver.id,a=e.receiver.type,e=e.user.content;try{"kefu"===t&&await i.invoke("SendMessage",e),"e0a82f97-d01d-43c0-a257-97998003e8b9"===t?await i.invoke("SendMessageToChatGpt",e):"friend"===a?await n.invoke("SendMessageToUser",t,e):"group"===a&&await n.invoke("SendMessageToGroup",t,e)}catch(e){console.error(e)}}),t.on("viewMmembers",loadMembers),t.callback("chatlog",async function(e){console.log(e);e=await fetch(`/Chat/ChatRecord/${e.receiver.id}?type=`+e.receiver.type);return e.json()})}});
//# sourceMappingURL=site.min.js.map